"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3742],{88475:function(e,t,o){var a=o(85893),s=o(79072),n=o(61953),l=o(29630),i=o(72389),r=o(80562),u=o(21609);let d=e=>{let{xs:t,md:o,title:d,removeItem:c,item:m,pending:p,index:x,textSuccess:v,textError:h}=e;return v=v||"Remover este item",h=h||"Este item n\xe3o pode ser removido pois possui cadastros vinculados a ele",(0,a.jsx)(s.ZP,{item:!0,xs:t,md:o,children:(0,a.jsxs)(n.Z,{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[(0,a.jsx)(l.Z,{variant:"caption",children:d}),(0,a.jsx)(i.Z,{title:1==p?h:v,children:(0,a.jsx)(r.Z,{color:"error",onClick(){1!=p&&c(m,x)},sx:{opacity:1==p?.5:1,cursor:1==p?"default":"pointer"},children:(0,a.jsx)(u.Z,{icon:"tabler:trash-filled"})})})]})})};t.Z=d},53742:function(e,t,o){o.d(t,{Z:function(){return V}});var a=o(85893),s=o(67294),n=o(87536),l=o(21609);o(49540);var i=o(56531),r=o(84220),u=o(29308);let d=e=>{var t,o,s,n,l;let{field:i,data:d,indexData:c,disabled:m,register:p,setValue:x,errors:v}=e;return console.log("product errors: ",v),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"hidden",name:"produtos[".concat(c,"].recebimentompProdutoID"),defaultValue:null==d?void 0:d.recebimentompProdutoID,...p("produtos[".concat(c,"].recebimentompProdutoID"))}),i&&"int"===i.tipo&&i.tabela&&(0,a.jsx)(r.Z,{xs:12,md:12,title:i.nomeCampo,name:"produtos[".concat(c,"].").concat(i.tabela),value:null!==(l=null==d?void 0:d[i.tabela])&&void 0!==l?l:null,multiple:!1,disabled:m,required:!0,options:i.options,register:p,setValue:x,errors:null==v?void 0:null===(t=v.produtos)||void 0===t?void 0:null===(o=t[c])||void 0===o?void 0:o[i.tabela]},c),i&&"string"===i.tipo&&(0,a.jsx)(u.Z,{title:i.nomeCampo,name:"produtos[".concat(c,"].").concat(i.nomeColuna),value:null==d?void 0:d[i.nomeColuna],type:i.nomeColuna,disabled:m,register:p,errors:null==v?void 0:null===(s=v.produtos)||void 0===s?void 0:null===(n=s[c])||void 0===n?void 0:n[i.nomeColuna]})]})};var c=o(79139),m=o(34282),p=o(88475),x=o(7071),v=o(19604),h=o(49837),b=o(91359),f=o(61953),g=o(29630),j=o(75084),D=o(79072),C=o(55343),Z=o(11163),S=o.n(Z),I=o(46749),y=o(60664),P=o(89191),E=o(60565),w=o(40039),R=o(47842),F=o(86501),O=o(66136),k=o(11935);o(30381),o(13860),o(57548);let M=()=>{var e,t;let{user:o,loggedUnity:r}=(0,s.useContext)(w.V),[Z,M]=(0,s.useState)(!1),[V,T]=(0,s.useState)(!1),[N,_]=(0,s.useState)(!1),[z,W]=(0,s.useState)(!0),[U,q]=(0,s.useState)(null),[B,L]=(0,s.useState)(!1),[H,J]=(0,s.useState)([]),[K,A]=(0,s.useState)(null),[G,Q]=(0,s.useState)([]),[X,Y]=(0,s.useState)([]),[$,ee]=(0,s.useState)([]),[et,eo]=(0,s.useState)([]),[ea,es]=(0,s.useState)(""),[en,el]=(0,s.useState)(!1),[ei,er]=(0,s.useState)({status:!1,errors:[]}),{settings:eu}=(0,s.useContext)(O.J6),[ed,ec]=(0,s.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),{setTitle:em,setStorageId:ep,getStorageId:ex}=(0,s.useContext)(E.f),ev=S(),{id:eh}=ev.query;eh||(eh=ex()),(0,s.useEffect)(()=>{ep(eh)},[]);let eb=(0,I.g_)(ev.pathname),ef=(0,I.Lo)(ev.pathname),{trigger:eg,reset:ej,register:eD,getValues:eC,setValue:eZ,handleSubmit:eS,clearErrors:eI,setError:ey,formState:{errors:eP}}=(0,n.cI)(),eE=async e=>{let t={status:e,auth:{usuarioID:o.usuarioID,papelID:o.papelID,unidadeID:r.unidadeID}};try{T(!0),await y.h.post("".concat(eb,"/changeFormStatus/").concat(eh),t).then(e=>{F.ZP.success(I.OD.successUpdate),T(!1)})}catch(a){console.log(a)}},ew=()=>{let e=[...X],t=G.map((e,t)=>e.tabela?{[e.tabela]:{id:"",nome:""}}:{[e.nomeColuna]:""});e.push(t),Y(e)},eR=[{id:1,name:"recebimentoMP",identification:"01",route:"relatorio/recebimentoMP",params:{recebimentompID:eh,unidadeID:r.unidadeID}},{id:2,name:"Recep\xe7\xe3o",identification:"02",route:"/relatorio/recepcao"}],eF=async()=>{try{await y.h.post("".concat(eb,"/verifyFormPending/").concat(eh),{parFormularioID:2}).then(e=>{W(e.data) //! true/false
})}catch(e){console.log(e)}},eO=()=>{try{M(!0),y.h.post("".concat(eb,"/getNewData"),{unidadeID:r.unidadeID}).then(e=>{J(e.data.fields),Q(e.data.fieldsProducts),Y(e.data.dataProducts),eo(e.data.blocos),es(e.data.info),ec({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),M(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},ek=()=>{M(!0),eh&&y.h.post("".concat(eb,"/getData/").concat(eh),{type:ef,unidadeID:r.unidadeID}).then(e=>{var t,o,a,s;J(e.data.fields),A(e.data.data),Q(e.data.fieldsProducts),Y(e.data.dataProducts),eo(e.data.blocos),es(e.data.info),eV(e.data),q(I.WR[null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(o=t.info)||void 0===o?void 0:o.status]),ec({status:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(s=a.info)||void 0===s?void 0:s.status)<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eF(),M(!1)})},eM=(e,t)=>{if(1==X.length){F.ZP.error("Voc\xea deve ter ao menos um produto!");return}let o=[...X];if(o.splice(t,1),Y(o),(null==e?void 0:e.recebimentompProdutoID)>0){let a=[...$,{recebimentompProdutoID:e.recebimentompProdutoID}];ee(a)}ej({...eC(),produtos:o}),eg(),F.ZP.success("Produto pr\xe9-removido. Salve para concluir!")},eV=e=>{var t,o,a,s,n;null==e||null===(t=e.fields)||void 0===t||t.map(t=>{var o,a,s,n;"int"==t.tipo?eZ("header.".concat(t.tabela),(null===(o=e.data)||void 0===o?void 0:o[t.tabela])?null===(a=e.data)||void 0===a?void 0:a[t.tabela]:null):"date"==t.tipo?eZ("header.".concat(t.nomeColuna),new Date(null===(s=e.data)||void 0===s?void 0:s[t.nomeColuna]).toISOString().split("T")[0]):eZ("header.".concat(t.nomeColuna),null===(n=e.data)||void 0===n?void 0:n[t.nomeColuna])}),null==e||null===(o=e.dataProducts)||void 0===o||o.map((t,o)=>{var a;null==e||null===(a=e.fieldsProducts)||void 0===a||a.map((e,a)=>{"int"==e.tipo?(console.log("\uD83D\uDE80 ~ data?.[field.tabela]:",null==t?void 0:t[e.tabela]),eZ("produtos[".concat(o,"].").concat(e.tabela),(null==t?void 0:t[e.tabela])?null==t?void 0:t[e.tabela]:null)):eZ("produtos[".concat(o,"].").concat(e.nomeColuna),null==t?void 0:t[e.nomeColuna])})}),null==e||null===(a=e.blocos)||void 0===a||a.map((e,t)=>{var o;null==e||null===(o=e.itens)||void 0===o||o.map((e,o)=>{(null==e?void 0:e.resposta)&&eZ("blocos[".concat(t,"].itens[").concat(o,"].resposta"),null==e?void 0:e.resposta)})}),eZ("obs",null===(s=e.info)||void 0===s?void 0:s.obs),eZ("status",null===(n=e.info)||void 0===n?void 0:n.status)},eT=()=>{eI();let e=!1,t=[];null==H||H.forEach((o,a)=>{let s=o.tabela?"header.".concat(o.tabela):"header.".concat(o.nomeColuna),n=eC(s);1!==o.obrigatorio||n||(ey(s,{type:"manual",message:"Campo obrigat\xf3rio"}),t.push(null==o?void 0:o.nomeCampo),e=!0)}),X.forEach((o,a)=>{G.forEach((o,s)=>{let n=o.tabela?"produtos[".concat(a,"].").concat(o.tabela):"produtos[".concat(a,"].").concat(o.nomeColuna),l=eC(n);1!==o.obrigatorio||l||(ey(n,{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==o?void 0:o.nomeCampo),e=!0)})}),et.forEach((o,a)=>{o.itens.forEach((o,s)=>{let n=eC("blocos[".concat(a,"].itens[").concat(s,"].resposta"));(null==o?void 0:o.obrigatorio)!==1||n||(ey("blocos[".concat(a,"].itens[").concat(s,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==o?void 0:o.nome),e=!0)})}),er({status:e,errors:t})},eN=()=>{eT(),el(!0),_(!0)},e_=async e=>{e.conclusion=!0,await eS(ez)(e)},ez=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t.conclusion&&t.status>10&&(e.status=t.status,e.obsConclusao=t.obsConclusao);let a={forms:{...e,header:{...e.header},produtos:[...e.produtos],removedProducts:$},auth:{usuarioID:o.usuarioID,papelID:o.papelID,unidadeID:r.unidadeID}};try{"edit"==ef?(T(!0),await y.h.put("".concat(eb,"/").concat(eh),a).then(e=>{F.ZP.success(I.OD.successUpdate),T(!1)})):"new"==ef?await y.h.post("".concat(eb,"/insertData"),a).then(e=>{let t=e.data;ev.push("".concat(eb,"/").concat(t)),F.ZP.success(I.OD.successNew)}):F.ZP.error(I.OD.error)}catch(s){console.log(s)}};return(0,s.useEffect)(()=>{em("Recebimento de MP"),"new"==ef?eO():ek()},[V]),(0,s.useEffect)(()=>{eT()},[]),(0,a.jsx)(a.Fragment,{children:Z?(0,a.jsx)(R.Z,{}):(0,a.jsxs)("form",{onSubmit:eS(ez),children:[!ed.status&&(0,a.jsx)(v.Z,{severity:ed.messageType,sx:{mb:2},children:ed.message}),(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(P.Z,{btnCancel:!0,btnSave:(null==ea?void 0:ea.status)<40||"new"==ef,btnSend:"edit"==ef,btnPrint:!0,generateReport:I.OE,dataReports:eR,handleSubmit:()=>eS(ez),handleSend:eN,title:"Recebimento MP",btnStatus:"edit"==ef,handleBtnStatus:()=>L(!0)}),(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(f.Z,{sx:{mb:4},children:(0,a.jsx)(f.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,a.jsx)(x.Z,{size:"small",skin:"light",color:null!==(e=null==U?void 0:U.color)&&void 0!==e?e:"primary",label:null!==(t=null==U?void 0:U.title)&&void 0!==t?t:"Novo preenchimento",sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})}),(0,a.jsx)(i.Z,{register:eD,errors:eP,setValue:eZ,fields:H,values:K,disabled:!ed.status})]})]}),(0,a.jsx)(h.Z,{sx:{mt:4},children:(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(g.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700,mb:5},children:"PRODUTOS"}),G&&X&&X.map((e,t)=>(0,a.jsxs)(f.Z,{display:"flex",justifyContent:"space-between",gap:4,sx:{mb:4},children:[G.map((o,s)=>(0,a.jsx)(f.Z,{flex:1,children:(0,a.jsx)(d,{field:o,data:e,indexData:t,disabled:!ed.status,register:eD,setValue:eZ,errors:eP})},s)),(0,a.jsx)(p.Z,{xs:12,md:1,title:"Remover",index:t,removeItem:eM,item:e,pending:!ed.status,textSuccess:"Remover este item",textError:"Este item n\xe3o pode mais ser removido pois j\xe1 foi respondido em um formul\xe1rio"})]},t)),(0,a.jsx)(j.Z,{variant:"outlined",color:"primary",disabled:!ed.status,sx:{mt:1},startIcon:(0,a.jsx)(l.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick(){ew()},children:"Inserir produto"})]})}),et&&et.map((e,t)=>(0,a.jsx)(c.Z,{index:t,blockKey:"parRecebimentompBlocoID",values:e,register:eD,setValue:eZ,errors:eP,isDisabled:!ed.status},t)),ea&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(h.Z,{sx:{mt:4},children:(0,a.jsx)(b.Z,{children:(0,a.jsx)(D.ZP,{container:!0,spacing:4,children:(0,a.jsx)(D.ZP,{item:!0,xs:12,md:12,children:(0,a.jsxs)(C.Z,{fullWidth:!0,children:[(0,a.jsx)(g.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,a.jsx)(u.Z,{title:"Observa\xe7\xe3o (opcional)",name:"obs",multiline:!0,rows:4,value:ea.obs,disabled:!ed.status,register:eD})]})})})})})}),B&&(0,a.jsx)(m.Z,{id:eh,parFormularioID:2,formStatus:ea.status,hasFormPending:z,canChangeStatus:ea.status>30&&!z,openModal:B,handleClose:()=>L(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(eh," de Recebimento de MP."),btnCancel:!0,btnConfirm:!0,handleSubmit:eE}),(0,a.jsx)(k.Z,{openModal:en,handleClose(){el(!1),_(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:ea,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:e_,listErrors:ei})]})})};var V=M}}]);