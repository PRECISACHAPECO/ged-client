"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9572],{29572:function(e,a,t){t.d(a,{Z:function(){return _}});var s=t(85893),o=t(67294),n=t(87536);t(21609);var i=t(56531),r=t(81284),l=t(95309),c=t(29630),d=t(22841),u=t(75158);let m=e=>{let{title:a,values:t,name:o,changeCategory:n,register:i,isDisabled:m}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsx)(l.Z,{children:(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600},children:a})})}),t&&t.map((e,a)=>(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("input",{type:"hidden",name:"".concat(o,".[").concat(a,"].id"),defaultValue:e.id,...i("".concat(o,".[").concat(a,"].id"))}),(0,s.jsx)(d.Z,{control:(0,s.jsx)(u.Z,{name:"".concat(o,"[").concat(a,"].checked"),disabled:!!m,...i("".concat(o,"[").concat(a,"].checked")),defaultChecked:1==e.checked,onClick:a=>n?n(e.id,!!a.target.checked):null}),label:e.nome})]})},a))]})};var x=t(79139),p=t(19604),h=t(49837),f=t(91359),g=t(61953),b=t(79072),D=t(55343),j=t(67836),Z=t(11163),v=t.n(Z),I=t(46749),S=t(60664),C=t(89191),y=t(60565),F=t(40039),P=t(47842);t(49540);var k=t(86501),E=t(66136),w=t(11935),O=t(7071);t(13860),t(57548),t(45061);var V=t(34282);let W=()=>{var e;let{user:a,loggedUnity:t}=(0,o.useContext)(F.V),{setTitle:r}=(0,o.useContext)(y.f),[l,d]=(0,o.useState)(!1),[u,Z]=(0,o.useState)(!1),[W,_]=(0,o.useState)(!1),[N,R]=(0,o.useState)([]),[T,z]=(0,o.useState)(null),[M,Q]=(0,o.useState)([]),[U,B]=(0,o.useState)([]),[L,q]=(0,o.useState)([]),[A,H]=(0,o.useState)([]),[J,K]=(0,o.useState)([]),[G,X]=(0,o.useState)(""),[Y,$]=(0,o.useState)(!1),[ee,ea]=(0,o.useState)(null),[et,es]=(0,o.useState)(null),[eo,en]=(0,o.useState)(!1),[ei,er]=(0,o.useState)(!1),[el,ec]=(0,o.useState)(!0),[ed,eu]=(0,o.useState)(0),[em,ex]=(0,o.useState)([]),[ep,eh]=(0,o.useState)({}),[ef,eg]=(0,o.useState)({status:!1,errors:[]}),[eb,eD]=(0,o.useState)(!1),[ej,eZ]=(0,o.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),ev=v(),{id:eI}=ev.query,eS=(0,I.g_)(ev.pathname),eC=(0,I.Lo)(ev.pathname),{settings:ey}=(0,o.useContext)(E.J6);ey.mode;let{watch:eF,register:eP,control:ek,getValues:eE,clearErrors:ew,setValue:eO,setError:eV,handleSubmit:eW,formState:{errors:e_}}=(0,n.cI)(),eN=e=>{e.blocos.map((e,a)=>{e.itens.map((e,t)=>{console.log("\uD83D\uDE80 ~ item:",e),(null==e?void 0:e.resposta)&&eO("blocos[".concat(a,"].itens[").concat(t,"].resposta"),null==e?void 0:e.resposta)})}),eO()},eR=async()=>{try{await S.h.post("/formularios/fornecedor/verifyFormPending/".concat(eI),{parFormularioID:1}).then(e=>{ec(e.data) //! true/false
})}catch(e){console.log(e)}},eT=async e=>{let s={status:e,auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{Z(!0),await S.h.post("".concat(eS,"/changeFormStatus/").concat(eI),s).then(e=>{k.ZP.success(I.OD.successUpdate),Z(!1)})}catch(o){console.log(o)}},ez=async()=>{let e={status:{edit:eo,status:G.status},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};if(eo)try{Z(!0),await S.h.post("".concat(eS,"/updateFormStatus/").concat(eI),e).then(e=>{k.ZP.success(I.OD.successUpdate),Z(!1)})}catch(s){console.log(s)}else k.ZP.error("N\xe3o h\xe1 dados a serem atualizados!")},eM=[{id:1,name:"Formul\xe1rio do fornecedor",component:"Fornecedor",papelID:a.papelID,identification:"01",params:{fornecedorID:eI}},{id:2,name:"Recep\xe7\xe3o",component:"Fornecedor",papelID:a.papelID,identification:"02"}],eQ=(e,a)=>{let t=[];e.map((e,s)=>{eB(e.categorias,a)&&t.push(e)}),K(t)},eU=(e,a)=>{let t=M.map(t=>t.id===e?{...t,checked:a}:t);Q(t),eQ(A,t)},eB=(e,a)=>{let t=e.map(e=>e.categoriaID),s=a.filter(e=>e.checked).map(e=>e.id);if(t.length!==s.length)return!1;let o=[...t].sort(),n=[...s].sort();for(let i=0;i<o.length;i++)if(o[i]!==n[i])return!1;return!0},eL=()=>{try{d(!0),S.h.get("".concat(eS,"/").concat(eI)).then(e=>{R(e.data.fields),Q(e.data.categorias),B(e.data.atividades),q(e.data.sistemasQualidade),H(e.data.blocos),eQ(e.data.blocos,e.data.categorias),z(e.data.data),X(e.data.info),ea(e.data.unidade),eN(e.data);let t=I.WR[e.data.info.status];es(t),eZ({status:2==a.papelID&&e.data.info.status<40,message:2==a.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==a.papelID?"warning":"info"}),d(!1)})}catch(e){console.log(e)}},eq=()=>{ev.push("/formularios/fornecedor/"),k.ZP.error("Voc\xea n\xe3o tem permiss\xf5es para acessar esta p\xe1gina!")},eA=()=>{eK(),$(!0),_(!0)},eH=async e=>{e.conclusion=!0,console.log("\uD83D\uDE80 ~ conclusionForm: ",e),await eW(eJ)(e)},eJ=async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===s.conclusion&&(e.status=a&&1==a.papelID?s.status:40,e.obsConclusao=s.obsConclusao);let o={forms:{...e,header:{...e.header}},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{Z(!0),await S.h.put("".concat(eS,"/").concat(eI),o).then(e=>{k.ZP.success(I.OD.successUpdate),Z(!1)})}catch(n){console.log(n)}},eK=()=>{ew();let e=!1,a=[];N.forEach((t,s)=>{let o=t.tabela?"header.".concat(t.tabela):"header.".concat(t.nomeColuna),n=eE(o);1!==t.obrigatorio||n||(eV(o,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==t?void 0:t.nomeCampo),e=!0)}),J.forEach((t,s)=>{t.itens.forEach((t,o)=>{let n=eE("blocos[".concat(s,"].itens[").concat(o,"].resposta"));(null==t?void 0:t.obrigatorio)!==1||n||(eV("blocos[".concat(s,"].itens[").concat(o,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==t?void 0:t.nome),e=!0)})}),eg({status:e,errors:a})};return(0,o.useEffect)(()=>{r("Formul\xe1rio do Fornecedor"),"edit"==eC?eL():eq(),eR()},[u]),(0,o.useEffect)(()=>{eK()},[]),(0,o.useEffect)(()=>{eb&&k.ZP.success("Dados copiados com sucesso!")},[eb]),(0,s.jsxs)(s.Fragment,{children:[l?(0,s.jsx)(P.Z,{}):T?(0,s.jsxs)("form",{onSubmit:eW(e=>{ej.status?eJ(e,!1):ez()}),children:[J&&0===J.length&&(0,s.jsx)(p.Z,{severity:"warning",sx:{mb:2},children:"N\xe3o h\xe1 nenhum bloco dispon\xedvel para as categorias selecionadas!"}),!ej.status&&(0,s.jsx)(p.Z,{severity:ej.messageType,sx:{mb:2},children:ej.message}),(0,s.jsxs)(h.Z,{children:[(0,s.jsx)(C.Z,{btnCancel:!0,btnSave:2==a.papelID&&G.status<40,btnSend:1==a.papelID&&G.status>=40||2==a.papelID&&G.status<40,disabledSend:0===J.length,disabledSubmit:0===J.length,btnPrint:!0,generateReport:I.OE,dataReports:eM,handleSubmit:()=>eW(eJ),handleSend:eA,title:"Fornecedor",btnStatus:!0,handleBtnStatus:()=>er(!0)}),(0,s.jsxs)(f.Z,{children:[ee&&(0,s.jsxs)(g.Z,{sx:{mb:4},children:[(0,s.jsx)("input",{type:"hidden",value:ee.unidadeID,name:"unidadeID",...eP("unidadeID")}),(0,s.jsxs)(b.ZP,{container:!0,spacing:4,children:[(0,s.jsxs)(b.ZP,{item:!0,xs:12,md:6,children:[(0,s.jsx)(c.Z,{variant:"caption",children:"F\xe1brica:"}),(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600},children:ee.nomeFantasia})]}),(0,s.jsx)(b.ZP,{item:!0,xs:12,md:6,children:et&&(0,s.jsx)(g.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,s.jsx)(O.Z,{size:"small",skin:"light",color:et.color,label:et.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})})]})]}),(0,s.jsx)(i.Z,{register:eP,errors:e_,setValue:eO,watch:eF,fields:N,values:T,isDisabled:!ej.status,setCopiedDataContext:eD}),(0,s.jsxs)(b.ZP,{container:!0,spacing:4,children:[(0,s.jsx)(b.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(m,{title:"Categorias",values:M,name:"categorias",changeCategory:eU,register:eP,isDisabled:!ej.status})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(m,{title:"Atividades",values:U,name:"atividades",register:eP,isDisabled:!ej.status})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(m,{title:"Sistema de Qualidade",values:L,name:"sistemasQualidade",register:eP,isDisabled:!ej.status})})]})]})]}),J&&J.map((e,a)=>(0,s.jsx)(x.Z,{index:a,blockKey:"parFornecedorBlocoID",values:e,register:eP,setValue:eO,errors:e_,isDisabled:!ej.status},a)),(0,s.jsx)(h.Z,{sx:{mt:4},children:(0,s.jsx)(f.Z,{children:(0,s.jsx)(b.ZP,{container:!0,spacing:4,children:(0,s.jsx)(b.ZP,{item:!0,xs:12,md:12,children:(0,s.jsxs)(D.Z,{fullWidth:!0,children:[(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,s.jsx)(j.Z,{multiline:!0,rows:4,label:"Observa\xe7\xe3o (opcional)",disabled:!ej.status,placeholder:"Observa\xe7\xe3o (opcional)",name:"obs",defaultValue:null!==(e=G.obs)&&void 0!==e?e:"",...eP("obs")})]})})})})})]}):null,(0,s.jsx)(w.Z,{openModal:Y,handleClose(){$(!1),_(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:G,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eH,listErrors:ef}),ei&&(0,s.jsx)(V.Z,{id:eI,parFormularioID:1,formStatus:G.status,hasFormPending:el,canChangeStatus:1==a.papelID&&!el&&G.status>30,openModal:ei,handleClose:()=>er(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(eI," do Fornecedor."),btnCancel:!0,btnConfirm:!0,handleSubmit:eT})]})};var _=W}}]);