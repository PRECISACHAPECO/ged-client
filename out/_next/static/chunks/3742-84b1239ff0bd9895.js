"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3742],{53742:function(e,t,o){o.d(t,{Z:function(){return N}});var a=o(85893),n=o(67294),s=o(87536),l=o(21609);o(49540);var i=o(56531),r=o(35966),u=o(67836),d=o(29308);let c=e=>{var t,o;let{field:n,data:s,indexData:l,isDisabled:i,register:c,setValue:m,errors:p}=e;return console.log("product errors: ",p),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"hidden",name:"produtos[".concat(l,"].recebimentompProdutoID"),defaultValue:null==s?void 0:s.recebimentompProdutoID,...c("produtos[".concat(l,"].recebimentompProdutoID"))}),n&&"int"===n.tipo&&n.tabela&&(0,a.jsx)(r.Z,{options:n.options,value:null==s?void 0:s[n.tabela],getOptionLabel:e=>e.nome,name:"produtos[".concat(l,"].").concat(n.tabela),disabled:!!i,...c("produtos[".concat(l,"].").concat(n.tabela)),onChange(e,t){m("produtos[".concat(l,"].").concat(n.tabela),t||null)},renderInput(e){var t,o;return(0,a.jsx)(u.Z,{...e,label:n.nomeCampo,placeholder:n.nomeCampo,error:null!=p&&null!==(t=p.produtos)&&void 0!==t&&null!==(o=t[l])&&void 0!==o&&!!o[n.tabela]})}},l),n&&"string"===n.tipo&&(0,a.jsx)(d.Z,{title:n.nomeCampo,name:"produtos[".concat(l,"].").concat(n.nomeColuna),value:null==s?void 0:s[n.nomeColuna],type:n.nomeColuna,isDisabled:i,register:c,errors:null==p?void 0:null===(t=p.produtos)||void 0===t?void 0:null===(o=t[l])||void 0===o?void 0:o[n.nomeColuna]})]})};var m=o(79139),p=o(34282),x=o(7071),b=o(19604),v=o(49837),h=o(91359),f=o(61953),g=o(29630),D=o(72389),C=o(80562),j=o(75084),Z=o(79072),I=o(55343),S=o(11163),y=o.n(S),P=o(46749),E=o(60664),w=o(89191),O=o(60565),F=o(40039),R=o(47842),k=o(86501),M=o(66136),T=o(11935);o(30381),o(13860),o(57548);let V=()=>{var e,t,o;let{user:r,loggedUnity:d}=(0,n.useContext)(F.V),{setTitle:S}=(0,n.useContext)(O.f),[V,N]=(0,n.useState)(!1),[_,z]=(0,n.useState)(!1),[W,q]=(0,n.useState)(!1),[L,U]=(0,n.useState)(!0),[B,H]=(0,n.useState)(null),[J,K]=(0,n.useState)(!1),[A,G]=(0,n.useState)([]),[Q,X]=(0,n.useState)(null),[Y,$]=(0,n.useState)([]),[ee,et]=(0,n.useState)([]),[eo,ea]=(0,n.useState)([]),[en,es]=(0,n.useState)([]),[el,ei]=(0,n.useState)(""),[er,eu]=(0,n.useState)(!1),[ed,ec]=(0,n.useState)({status:!1,errors:[]}),{settings:em}=(0,n.useContext)(M.J6),[ep,ex]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eb=y(),ev=(0,P.g_)(eb.pathname),eh=(0,P.Lo)(eb.pathname),ef=eb.query.id,eg=localStorage.getItem("dynamicId"),eD=()=>{let{id:e}=eb.query;e&&localStorage.setItem("dynamicId",e)},eC=()=>(ef||(ef=eg),ef);(0,n.useEffect)(()=>{let{id:e}=eb.query;eC(e)},[]),(0,n.useEffect)(()=>{eD()},[]);let{trigger:ej,reset:eZ,register:eI,getValues:eS,setValue:ey,handleSubmit:eP,clearErrors:eE,setError:ew,formState:{errors:eO}}=(0,s.cI)(),eF=async e=>{let t={status:e,auth:{usuarioID:r.usuarioID,papelID:r.papelID,unidadeID:d.unidadeID}};try{z(!0),await E.h.post("".concat(ev,"/changeFormStatus/").concat(ef),t).then(e=>{k.ZP.success(P.OD.successUpdate),z(!1)})}catch(o){console.log(o)}},eR=()=>{let e=[...ee],t=Y.map((e,t)=>e.tabela?{[e.tabela]:{id:"",nome:""}}:{[e.nomeColuna]:""});e.push(t),et(e)},ek=[{id:1,name:"recebimentoMP",identification:"01",route:"relatorio/recebimentoMP",params:{recebimentompID:ef,unidadeID:d.unidadeID}},{id:2,name:"Recep\xe7\xe3o",identification:"02",route:"/relatorio/recepcao"}],eM=async()=>{try{await E.h.post("".concat(ev,"/verifyFormPending/").concat(ef),{parFormularioID:2}).then(e=>{U(e.data) //! true/false
})}catch(e){console.log(e)}},eT=()=>{try{N(!0),E.h.post("".concat(ev,"/getNewData"),{unidadeID:d.unidadeID}).then(e=>{G(e.data.fields),$(e.data.fieldsProducts),et(e.data.dataProducts),es(e.data.blocos),ei(e.data.info),ex({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),N(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},eV=()=>{N(!0),ef&&E.h.post("".concat(ev,"/getData/").concat(ef),{type:eh,unidadeID:d.unidadeID}).then(e=>{var t,o,a,n;G(e.data.fields),X(e.data.data),$(e.data.fieldsProducts),et(e.data.dataProducts),es(e.data.blocos),ei(e.data.info),e_(e.data),H(P.WR[null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(o=t.info)||void 0===o?void 0:o.status]),ex({status:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(n=a.info)||void 0===n?void 0:n.status)<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eM(),N(!1)})},eN=(e,t)=>{if(1==ee.length){k.ZP.error("Voc\xea deve ter ao menos um produto!");return}let o=[...ee];if(o.splice(t,1),et(o),(null==e?void 0:e.recebimentompProdutoID)>0){let a=[...eo,{recebimentompProdutoID:e.recebimentompProdutoID}];ea(a)}eZ({...eS(),produtos:o}),ej(),k.ZP.success("Produto pr\xe9-removido. Salve para concluir!")},e_=e=>{var t,o,a,n,s;null==e||null===(t=e.fields)||void 0===t||t.map(t=>{var o,a,n,s;"int"==t.tipo?ey("header.".concat(t.tabela),(null===(o=e.data)||void 0===o?void 0:o[t.tabela])?null===(a=e.data)||void 0===a?void 0:a[t.tabela]:null):"date"==t.tipo?ey("header.".concat(t.nomeColuna),new Date(null===(n=e.data)||void 0===n?void 0:n[t.nomeColuna]).toISOString().split("T")[0]):ey("header.".concat(t.nomeColuna),null===(s=e.data)||void 0===s?void 0:s[t.nomeColuna])}),null==e||null===(o=e.dataProducts)||void 0===o||o.map((t,o)=>{var a;null==e||null===(a=e.fieldsProducts)||void 0===a||a.map((e,a)=>{"int"==e.tipo?(console.log("\uD83D\uDE80 ~ data?.[field.tabela]:",null==t?void 0:t[e.tabela]),ey("produtos[".concat(o,"].").concat(e.tabela),(null==t?void 0:t[e.tabela])?null==t?void 0:t[e.tabela]:null)):ey("produtos[".concat(o,"].").concat(e.nomeColuna),null==t?void 0:t[e.nomeColuna])})}),null==e||null===(a=e.blocos)||void 0===a||a.map((e,t)=>{var o;null==e||null===(o=e.itens)||void 0===o||o.map((e,o)=>{(null==e?void 0:e.resposta)&&ey("blocos[".concat(t,"].itens[").concat(o,"].resposta"),null==e?void 0:e.resposta)})}),ey("obs",null===(n=e.info)||void 0===n?void 0:n.obs),ey("status",null===(s=e.info)||void 0===s?void 0:s.status)},ez=()=>{eE();let e=!1,t=[];null==A||A.forEach((o,a)=>{let n=o.tabela?"header.".concat(o.tabela):"header.".concat(o.nomeColuna),s=eS(n);1!==o.obrigatorio||s||(ew(n,{type:"manual",message:"Campo obrigat\xf3rio"}),t.push(null==o?void 0:o.nomeCampo),e=!0)}),ee.forEach((o,a)=>{Y.forEach((o,n)=>{let s=o.tabela?"produtos[".concat(a,"].").concat(o.tabela):"produtos[".concat(a,"].").concat(o.nomeColuna),l=eS(s);1!==o.obrigatorio||l||(ew(s,{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==o?void 0:o.nomeCampo),e=!0)})}),en.forEach((o,a)=>{o.itens.forEach((o,n)=>{let s=eS("blocos[".concat(a,"].itens[").concat(n,"].resposta"));(null==o?void 0:o.obrigatorio)!==1||s||(ew("blocos[".concat(a,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==o?void 0:o.nome),e=!0)})}),ec({status:e,errors:t})},eW=()=>{ez(),eu(!0),q(!0)},eq=async e=>{e.conclusion=!0,await eP(eL)(e)},eL=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t.conclusion&&t.status>10&&(e.status=t.status,e.obsConclusao=t.obsConclusao);let o={forms:{...e,header:{...e.header},produtos:[...e.produtos],removedProducts:eo},auth:{usuarioID:r.usuarioID,papelID:r.papelID,unidadeID:d.unidadeID}};try{"edit"==eh?(z(!0),await E.h.put("".concat(ev,"/").concat(ef),o).then(e=>{k.ZP.success(P.OD.successUpdate),z(!1)})):"new"==eh?await E.h.post("".concat(ev,"/insertData"),o).then(e=>{let t=e.data;eb.push("".concat(ev,"/").concat(t)),k.ZP.success(P.OD.successNew)}):k.ZP.error(P.OD.error)}catch(a){console.log(a)}};return(0,n.useEffect)(()=>{S("Recebimento de MP"),"new"==eh?eT():eV()},[_]),(0,n.useEffect)(()=>{ez()},[]),(0,a.jsx)(a.Fragment,{children:V?(0,a.jsx)(R.Z,{}):(0,a.jsxs)("form",{onSubmit:eP(eL),children:[!ep.status&&(0,a.jsx)(b.Z,{severity:ep.messageType,sx:{mb:2},children:ep.message}),(0,a.jsxs)(v.Z,{children:[(0,a.jsx)(w.Z,{btnCancel:!0,btnSave:(null==el?void 0:el.status)<40||"new"==eh,btnSend:"edit"==eh,btnPrint:!0,generateReport:P.OE,dataReports:ek,handleSubmit:()=>eP(eL),handleSend:eW,title:"Recebimento MP",btnStatus:"edit"==eh,handleBtnStatus:()=>K(!0)}),(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(f.Z,{sx:{mb:4},children:(0,a.jsx)(f.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,a.jsx)(x.Z,{size:"small",skin:"light",color:null!==(e=null==B?void 0:B.color)&&void 0!==e?e:"primary",label:null!==(t=null==B?void 0:B.title)&&void 0!==t?t:"Novo preenchimento",sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})}),(0,a.jsx)(i.Z,{register:eI,errors:eO,setValue:ey,fields:A,values:Q,disabled:!ep.status})]})]}),(0,a.jsx)(v.Z,{sx:{mt:4},children:(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(g.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700,mb:5},children:"PRODUTOS"}),Y&&ee&&ee.map((e,t)=>(0,a.jsxs)(f.Z,{display:"flex",justifyContent:"space-between",gap:4,sx:{mb:4},children:[Y.map((o,n)=>(0,a.jsx)(f.Z,{flex:1,children:(0,a.jsx)(c,{field:o,data:e,indexData:t,isDisabled:!ep.status,register:eI,setValue:ey,errors:eO})},n)),(0,a.jsx)(f.Z,{children:(0,a.jsx)(D.Z,{title:"Remover este item",children:(0,a.jsx)(C.Z,{color:"error",disabled:!ep.status,onClick(){eN(e,t)},sx:{marginTop:2,opacity:1,cursor:"pointer"},children:(0,a.jsx)(l.Z,{icon:"tabler:trash-filled"})})})})]},t)),(0,a.jsx)(j.Z,{variant:"outlined",color:"primary",disabled:!ep.status,sx:{mt:1},startIcon:(0,a.jsx)(l.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick(){eR()},children:"Inserir produto"})]})}),en&&en.map((e,t)=>(0,a.jsx)(m.Z,{index:t,blockKey:"parRecebimentompBlocoID",values:e,register:eI,setValue:ey,errors:eO,isDisabled:!ep.status},t)),el&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(v.Z,{sx:{mt:4},children:(0,a.jsx)(h.Z,{children:(0,a.jsx)(Z.ZP,{container:!0,spacing:4,children:(0,a.jsx)(Z.ZP,{item:!0,xs:12,md:12,children:(0,a.jsxs)(I.Z,{fullWidth:!0,children:[(0,a.jsx)(g.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,a.jsx)(u.Z,{multiline:!0,rows:4,label:"Observa\xe7\xe3o (opcional)",disabled:!ep.status,placeholder:"Observa\xe7\xe3o (opcional)",defaultValue:null!==(o=el.obs)&&void 0!==o?o:"",name:"obs",...eI("obs")})]})})})})})}),J&&(0,a.jsx)(p.Z,{id:ef,parFormularioID:2,formStatus:el.status,hasFormPending:L,canChangeStatus:el.status>30&&!L,openModal:J,handleClose:()=>K(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(ef," de Recebimento de MP."),btnCancel:!0,btnConfirm:!0,handleSubmit:eF}),(0,a.jsx)(T.Z,{openModal:er,handleClose(){eu(!1),q(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:el,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eq,listErrors:ed})]})})};var N=V}}]);