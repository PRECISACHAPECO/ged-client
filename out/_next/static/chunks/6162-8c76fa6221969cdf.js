"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6162],{86162:function(e,a,t){t.d(a,{Z:function(){return N}});var o=t(85893),s=t(67294),n=t(87536);t(21609),t(50196);var i=t(56531),r=t(81284),l=t(95309),d=t(29630),c=t(22841),u=t(75158);let p=e=>{let{title:a,values:t,name:s,changeCategory:n,register:i,isDisabled:p}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.ZP,{disablePadding:!0,children:(0,o.jsx)(l.Z,{children:(0,o.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600},children:a})})}),t&&t.map((e,a)=>(0,o.jsx)(r.ZP,{disablePadding:!0,children:(0,o.jsxs)(l.Z,{children:[(0,o.jsx)("input",{type:"hidden",name:"".concat(s,".[").concat(a,"].id"),defaultValue:e.id,...i("".concat(s,".[").concat(a,"].id"))}),(0,o.jsx)(c.Z,{control:(0,o.jsx)(u.Z,{name:"".concat(s,"[").concat(a,"].checked"),disabled:!!p,...i("".concat(s,"[").concat(a,"].checked")),defaultChecked:1==e.checked,onClick:a=>n?n(e.id,!!a.target.checked):null}),label:e.nome})]})},a))]})};var m=t(79139),x=t(19604),h=t(49837),f=t(91359),g=t(61953),D=t(79072),I=t(75084),b=t(55343),v=t(67836),j=t(11163),Z=t.n(j),y=t(46749),S=t(60664),C=t(89191),F=t(60565),P=t(40039),A=t(47842);t(49540);var k=t(86501),E=t(66136),w=t(11935),z=t(7071);t(13860),t(57548),t(45061);var O=t(34282);let q=()=>{var e;let{user:a,loggedUnity:t}=(0,s.useContext)(P.V),{setTitle:r}=(0,s.useContext)(F.f),[l,c]=(0,s.useState)(!1),[u,j]=(0,s.useState)(!1),[q,N]=(0,s.useState)(!1),[R,T]=(0,s.useState)([]),[V,M]=(0,s.useState)(null),[W,_]=(0,s.useState)([]),[Q,U]=(0,s.useState)([]),[B,L]=(0,s.useState)([]),[H,J]=(0,s.useState)([]),[K,X]=(0,s.useState)([]),[G,Y]=(0,s.useState)([]),[$,ee]=(0,s.useState)(""),[ea,et]=(0,s.useState)(!1),[eo,es]=(0,s.useState)(null),[en,ei]=(0,s.useState)(null),[er,el]=(0,s.useState)(!1),[ed,ec]=(0,s.useState)(!1),[eu,ep]=(0,s.useState)(!0),[em,ex]=(0,s.useState)(0),[eh,ef]=(0,s.useState)([]),[eg,eD]=(0,s.useState)({}),[eI,eb]=(0,s.useState)({status:!1,errors:[]}),[ev,ej]=(0,s.useState)(!1),[eZ,ey]=(0,s.useState)(null),[eS,eC]=(0,s.useState)([]),[eF,eP]=(0,s.useState)([]),[eA,ek]=(0,s.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eE=Z(),{id:ew}=eE.query,ez=(0,y.g_)(eE.pathname),eO=(0,y.Lo)(eE.pathname),{settings:eq}=(0,s.useContext)(E.J6),eN=eq.mode,{watch:eR,register:eT,control:eV,getValues:eM,clearErrors:eW,setValue:e_,setError:eQ,handleSubmit:eU,formState:{errors:eB}}=(0,n.cI)(),eL=localStorage.getItem("dynamicId"),eH=()=>{let{id:e}=eE.query;e&&localStorage.setItem("dynamicId",e)},eJ=()=>(ew||(ew=eL),ew);(0,s.useEffect)(()=>{let{id:e}=eE.query;eJ(e)},[]),(0,s.useEffect)(()=>{eH()},[]);let eK=e=>{var a;null==e||null===(a=e.blocos)||void 0===a||a.map((e,a)=>{var t;null==e||null===(t=e.itens)||void 0===t||t.map((e,t)=>{(null==e?void 0:e.resposta)&&e_("blocos[".concat(a,"].itens[").concat(t,"].resposta"),null==e?void 0:e.resposta)})}),e_()},eX=async()=>{try{await S.h.post("/formularios/fornecedor/verifyFormPending/".concat(ew),{parFormularioID:1}).then(e=>{ep(e.data) //! true/false
})}catch(e){console.log(e)}},eG=async e=>{let o={status:e,auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{j(!0),await S.h.post("".concat(ez,"/changeFormStatus/").concat(ew),o).then(e=>{k.ZP.success(y.OD.successUpdate),j(!1)})}catch(s){console.log(s)}},eY=async()=>{let e={status:{edit:er,status:$.status},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};if(er)try{j(!0),await S.h.post("".concat(ez,"/updateFormStatus/").concat(ew),e).then(e=>{k.ZP.success(y.OD.successUpdate),j(!1)})}catch(o){console.log(o)}else k.ZP.error("N\xe3o h\xe1 dados a serem atualizados!")},e$=[{id:1,name:"Formul\xe1rio do fornecedor",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor",papelID:a.papelID,identification:"01",params:{fornecedorID:ew}},{id:2,name:"Teste relat\xf3rio1",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor/teste",papelID:a.papelID,identification:"02"},{id:3,name:"Teste relat\xf3rio2",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor/teste2",papelID:a.papelID,identification:"03"}],e0=(e,a)=>{let t=[];null==e||e.map((e,o)=>{e2(e.categorias,a)&&t.push(e)}),Y(t)},e1=(e,a)=>{let t=W.map(t=>t.id===e?{...t,checked:a}:t);_(t),e0(K,t)},e2=(e,a)=>{let t=e.map(e=>e.categoriaID),o=a.filter(e=>e.checked).map(e=>e.id);if(t.length!==o.length)return!1;let s=[...t].sort(),n=[...o].sort();for(let i=0;i<s.length;i++)if(s[i]!==n[i])return!1;return!0},e4=()=>{try{c(!0),ew&&S.h.get("".concat(ez,"/").concat(ew)).then(e=>{console.log("getData: ",e.data.grupoAnexo),T(e.data.fields),_(e.data.categorias),U(e.data.atividades),L(e.data.sistemasQualidade),X(e.data.blocos),e0(e.data.blocos,e.data.categorias),M(e.data.data),J(e.data.grupoAnexo),e.data.grupoAnexo.map((e,t)=>{e.itens.map((e,t)=>{console.log("\uD83D\uDE80 ~ itemm:",e),console.log("\uD83D\uDE80 ~ itemmAnexoo:",e.anexo),e.anexo&&eS.push({titulo:e.nome,grupoAnexoItemID:e.grupoanexoitemID,arquivo:e.anexo,usuarioID:a.usuarioID,recebimentoMpID:"",naoConformidadeID:"",file:{status:!0,name:e.anexo.path,size:e.anexo.size,type:e.anexo.type,path:e.anexo.time}})})}),ee(e.data.info),es(e.data.unidade),eK(e.data);let t=y.WR[e.data.info.status];ei(t),ek({status:2==a.papelID&&e.data.info.status<40,message:2==a.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==a.papelID?"warning":"info"}),c(!1)})}catch(e){console.log(e)}};console.log("ARRRANEXONOVO",eS);let e3=()=>{eE.push("/formularios/fornecedor/"),k.ZP.error("Voc\xea n\xe3o tem permiss\xf5es para acessar esta p\xe1gina!")},e6=()=>{e9(),et(!0),N(!0)},e5=async e=>{e.conclusion=!0,await eU(e8)(e)},e8=async function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===o.conclusion&&(e.status=a&&1==a.papelID?o.status:40,e.obsConclusao=o.obsConclusao);let s={forms:{...e,header:{...e.header}},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{j(!0),await S.h.put("".concat(ez,"/").concat(ew),s).then(e=>{k.ZP.success(y.OD.successUpdate),j(!1)})}catch(n){console.log(n)}},e9=()=>{eW();let e=!1,a=[];R.forEach((t,o)=>{let s=t.tabela?"header.".concat(t.tabela):"header.".concat(t.nomeColuna),n=eM(s);1!==t.obrigatorio||n||(eQ(s,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==t?void 0:t.nomeCampo),e=!0)}),G.forEach((t,o)=>{t.itens.forEach((t,s)=>{let n=eM("blocos[".concat(o,"].itens[").concat(s,"].resposta"));(null==t?void 0:t.obrigatorio)!==1||n||(eQ("blocos[".concat(o,"].itens[").concat(s,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==t?void 0:t.nome),e=!0)})}),eb({status:e,errors:a})};(0,s.useEffect)(()=>{r("Formul\xe1rio do Fornecedor"),"edit"==eO?e4():e3(),eX()},[u]),(0,s.useEffect)(()=>{e9()},[]),(0,s.useEffect)(()=>{ev&&k.ZP.success("Dados copiados com sucesso!")},[ev]);let e7=(0,s.useRef)(null),ae=e=>{e7.current.click(),ey(e)},aa=e=>{console.log("choegou akii");let t=e.target.files[0];if((null==t?void 0:t.type)!=="application/pdf"){k.ZP.error("Formato de arquivo inv\xe1lido, selecione um arquivo PDF!");return}let o=eS.find(e=>e.grupoAnexoItemID===eZ.grupoanexoitemID);if(o){let s={...o,titulo:eZ.nome,arquivo:t,file:{status:!0,name:t.name,size:t.size,type:t.type,time:new Date().getTime()}},n=eS.map(e=>(console.log("\uD83D\uDE80 ~ anexo.grupoAnexoItemID:",e.grupoAnexoItemID),e.grupoAnexoItemID===eZ.grupoanexoitemID?s:e));eF.splice(eF.indexOf(o),1),eC(n)}else{let i={titulo:eZ.nome,grupoAnexoItemID:eZ.grupoanexoitemID,arquivo:t,usuarioID:a.usuarioID,recebimentoMpID:"",naoConformidadeID:"",file:{status:!0,name:null==t?void 0:t.name,size:null==t?void 0:t.size,type:null==t?void 0:t.type}};eC([...eS,i]),eF.splice(eF.indexOf(o),1)}},at=async()=>{let e=new FormData;if(0===eS.length){k.ZP.error("Selecione ao menos um arquivo para enviar!");return}eS.forEach((a,o)=>{e.append("pdfFiles",a.arquivo),e.append("titulo",a.titulo),e.append("tamanho",a.file.size),e.append("grupoAnexoItemID",a.grupoAnexoItemID),e.append("usuarioID",a.usuarioID),e.append("recebimentoMpID",a.recebimentoMpID),e.append("naoConformidadeID",a.naoConformidadeID),e.append("unidadeID",t.unidadeID),e.append("arrAnexoRemoved",eF)}),console.log("enviando.."),await S.h.post("/formularios/fornecedor/saveAnexo/".concat(ew),e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{200===e.status&&(k.ZP.success("Anexos enviados com sucesso!"),eC([]),ey({}),j(!u))})},ao=e=>{let a=eS.filter(a=>a.grupoAnexoItemID!==e);eC(a),eP([...eF,e])};return console.log("lista de ids removidos",eF),(0,o.jsxs)(o.Fragment,{children:[l?(0,o.jsx)(A.Z,{}):R?(0,o.jsxs)("form",{onSubmit:eU(e=>{eA.status?e8(e,!1):eY()}),children:[G&&0===G.length&&(0,o.jsx)(x.Z,{severity:"warning",sx:{mb:2},children:"N\xe3o h\xe1 nenhum bloco dispon\xedvel para as categorias selecionadas!"}),!eA.status&&(0,o.jsx)(x.Z,{severity:eA.messageType,sx:{mb:2},children:eA.message}),(0,o.jsxs)(h.Z,{children:[(0,o.jsx)(C.Z,{btnCancel:!0,btnSave:2==a.papelID&&$.status<40,btnSend:1==a.papelID&&$.status>=40||2==a.papelID&&$.status<40,disabledSend:0===G.length,disabledSubmit:0===G.length,disabledPrint:0===G.length,btnPrint:!0,generateReport:y.OE,dataReports:e$,handleSubmit:()=>eU(e8),handleSend:e6,title:"Fornecedor",btnStatus:!0,handleBtnStatus:()=>ec(!0)}),(0,o.jsxs)(f.Z,{children:[eo&&(0,o.jsxs)(g.Z,{sx:{mb:4},children:[(0,o.jsx)("input",{type:"hidden",value:eo.unidadeID,name:"unidadeID",...eT("unidadeID")}),(0,o.jsxs)(D.ZP,{container:!0,spacing:4,children:[(0,o.jsxs)(D.ZP,{item:!0,xs:12,md:6,children:[(0,o.jsx)(d.Z,{variant:"caption",children:"F\xe1brica:"}),(0,o.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600},children:eo.nomeFantasia})]}),(0,o.jsx)(D.ZP,{item:!0,xs:12,md:6,children:en&&(0,o.jsx)(g.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,o.jsx)(z.Z,{size:"small",skin:"light",color:en.color,label:en.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})})]})]}),(0,o.jsx)(i.Z,{register:eT,errors:eB,setValue:e_,watch:eR,fields:R,values:V,isDisabled:!eA.status,setCopiedDataContext:ej}),(0,o.jsxs)(D.ZP,{container:!0,spacing:4,children:[(0,o.jsx)(D.ZP,{item:!0,xs:12,md:4,children:(0,o.jsx)(p,{title:"Categorias",values:W,name:"categorias",changeCategory:e1,register:eT,isDisabled:!eA.status})}),(0,o.jsx)(D.ZP,{item:!0,xs:12,md:4,children:(0,o.jsx)(p,{title:"Atividades",values:Q,name:"atividades",register:eT,isDisabled:!eA.status})}),(0,o.jsx)(D.ZP,{item:!0,xs:12,md:4,children:(0,o.jsx)(p,{title:"Sistema de Qualidade",values:B,name:"sistemasQualidade",register:eT,isDisabled:!eA.status})})]})]})]}),G&&G.map((e,a)=>(0,o.jsx)(m.Z,{index:a,blockKey:"parFornecedorBlocoID",values:e,register:eT,setValue:e_,errors:eB,isDisabled:!eA.status},a)),H&&(0,o.jsxs)(o.Fragment,{children:[H.map((e,a)=>(0,o.jsx)(h.Z,{sx:{mt:4},children:(0,o.jsxs)(f.Z,{children:[(0,o.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:e.nome}),(0,o.jsx)(d.Z,{variant:"body2",sx:{mb:2},children:e.descricao}),(0,o.jsx)(D.ZP,{container:!0,spacing:4,children:e.itens.map((e,t)=>(0,o.jsx)(D.ZP,{item:!0,xs:12,md:4,children:(0,o.jsxs)(g.Z,{style:{border:"".concat("dark"==eN?"1px solid rgba(234, 234, 255, 0.10)":"1px solid rgba(76, 78, 100, 0.12)"),borderRadius:"12px",padding:"25px",paddingTop:"120px",display:"flex",flexDirection:"column",gap:"6px",position:"relative",zIndex:10},children:[(0,o.jsxs)("div",{onClick:()=>ae(e),className:"cursor-pointer ",children:[(0,o.jsx)("img",{src:"/images/storyset/a.svg",alt:"",className:"w-[20%] top-8 left-0 absolute"}),(0,o.jsxs)("div",{children:[(0,o.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:e.nome}),(0,o.jsx)(d.Z,{variant:"body2",sx:{mb:2},children:e.descricao})]})]}),(()=>{let a=eS.find(a=>e.grupoanexoitemID==a.grupoAnexoItemID);if(a){var t,s;return(0,o.jsxs)("div",{className:"flex p-2 items-center justify-between gap-2 rounded-lg ",style:{border:"".concat("dark"==eN?"1px dashed rgba(234, 234, 255, 0.10)":"1px dashed rgba(76, 78, 100, 0.12)")},children:[(0,o.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,o.jsx)("img",{width:28,height:28,alt:"invoice.pdf",src:"/images/icons/file-icons/pdf.png"}),(0,o.jsx)(d.Z,{variant:"body2",children:"".concat(null==a?void 0:null===(t=a.file)||void 0===t?void 0:t.name," (").concat(((null==a?void 0:null===(s=a.file)||void 0===s?void 0:s.size)/1024/1024).toFixed(2),"mb)")})]}),(0,o.jsx)("div",{style:{zIndex:9999},children:(0,o.jsx)(I.Z,{variant:"outlined",size:"small",onClick:()=>ao(a.grupoAnexoItemID),children:"Remover"})})]})}return null})(),(0,o.jsx)("input",{type:"file",ref:e7,style:{display:"none"},onChange:aa})]})},"".concat(a,"-").concat(t)))})]})},a)),(0,o.jsx)(I.Z,{variant:"contained",onClick:at,children:"Enviar Anexos"})]}),(0,o.jsx)(h.Z,{sx:{mt:4},children:(0,o.jsx)(f.Z,{children:(0,o.jsx)(D.ZP,{container:!0,spacing:4,children:(0,o.jsx)(D.ZP,{item:!0,xs:12,md:12,children:(0,o.jsxs)(b.Z,{fullWidth:!0,children:[(0,o.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,o.jsx)(v.Z,{multiline:!0,rows:4,label:"Observa\xe7\xe3o (opcional)",disabled:!eA.status,placeholder:"Observa\xe7\xe3o (opcional)",name:"obs",defaultValue:null!==(e=$.obs)&&void 0!==e?e:"",...eT("obs")})]})})})})})]}):null,(0,o.jsx)(w.Z,{openModal:ea,handleClose(){et(!1),N(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:$,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:e5,listErrors:eI}),ed&&(0,o.jsx)(O.Z,{id:ew,parFormularioID:1,formStatus:$.status,hasFormPending:eu,canChangeStatus:1==a.papelID&&!eu&&$.status>30,openModal:ed,handleClose:()=>ec(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(ew," do Fornecedor."),btnCancel:!0,btnConfirm:!0,handleSubmit:eG})]})};var N=q}}]);