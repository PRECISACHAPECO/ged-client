"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3742],{53742:function(e,t,a){a.d(t,{Z:function(){return N}});var o=a(85893),s=a(67294),n=a(87536),l=a(21609);a(49540);var r=a(56531),i=a(35966),c=a(67836),u=a(29308);let d=e=>{var t,a;let{field:s,data:n,indexData:l,isDisabled:r,register:d,setValue:m,errors:p}=e;return console.log("product errors: ",p),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("input",{type:"hidden",name:"produtos[".concat(l,"].recebimentompProdutoID"),defaultValue:null==n?void 0:n.recebimentompProdutoID,...d("produtos[".concat(l,"].recebimentompProdutoID"))}),s&&"int"===s.tipo&&s.tabela&&(0,o.jsx)(i.Z,{options:s.options,value:null==n?void 0:n[s.tabela],getOptionLabel:e=>e.nome,name:"produtos[".concat(l,"].").concat(s.tabela),disabled:!!r,...d("produtos[".concat(l,"].").concat(s.tabela)),onChange(e,t){m("produtos[".concat(l,"].").concat(s.tabela),t||null)},renderInput(e){var t,a;return(0,o.jsx)(c.Z,{...e,label:s.nomeCampo,placeholder:s.nomeCampo,error:null!=p&&null!==(t=p.produtos)&&void 0!==t&&null!==(a=t[l])&&void 0!==a&&!!a[s.tabela]})}},l),s&&"string"===s.tipo&&(0,o.jsx)(u.Z,{title:s.nomeCampo,name:"produtos[".concat(l,"].").concat(s.nomeColuna),value:null==n?void 0:n[s.nomeColuna],type:s.nomeColuna,isDisabled:r,register:d,errors:null==p?void 0:null===(t=p.produtos)||void 0===t?void 0:null===(a=t[l])||void 0===a?void 0:a[s.nomeColuna]})]})};var m=a(79139),p=a(34282),x=a(7071),b=a(19604),h=a(49837),v=a(91359),f=a(61953),g=a(29630),D=a(72389),C=a(80562),j=a(75084),Z=a(79072),S=a(55343),I=a(11163),P=a.n(I),y=a(46749),E=a(60664),w=a(89191),O=a(60565),F=a(40039),R=a(47842),k=a(86501),M=a(66136),T=a(11935);a(30381),a(13860),a(57548);let V=()=>{var e,t,a;let{user:i,loggedUnity:u}=(0,s.useContext)(F.V),{setTitle:I}=(0,s.useContext)(O.f),[V,N]=(0,s.useState)(!1),[_,z]=(0,s.useState)(!1),[W,L]=(0,s.useState)(!1),[U,B]=(0,s.useState)(!0),[q,H]=(0,s.useState)(null),[J,K]=(0,s.useState)(!1),[A,G]=(0,s.useState)([]),[Q,X]=(0,s.useState)(null),[Y,$]=(0,s.useState)([]),[ee,et]=(0,s.useState)([]),[ea,eo]=(0,s.useState)([]),[es,en]=(0,s.useState)([]),[el,er]=(0,s.useState)(""),[ei,ec]=(0,s.useState)(!1),[eu,ed]=(0,s.useState)({status:!1,errors:[]}),[em,ep]=(0,s.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),ex=P(),{id:eb}=ex.query,eh=(0,y.g_)(ex.pathname),ev=(0,y.Lo)(ex.pathname),{settings:ef}=(0,s.useContext)(M.J6),{trigger:eg,reset:eD,register:eC,getValues:ej,setValue:eZ,handleSubmit:eS,clearErrors:eI,setError:eP,formState:{errors:ey}}=(0,n.cI)(),eE=async e=>{let t={status:e,auth:{usuarioID:i.usuarioID,papelID:i.papelID,unidadeID:u.unidadeID}};try{z(!0),await E.h.post("".concat(eh,"/changeFormStatus/").concat(eb),t).then(e=>{k.ZP.success(y.OD.successUpdate),z(!1)})}catch(a){console.log(a)}},ew=()=>{let e=[...ee],t=Y.map((e,t)=>e.tabela?{[e.tabela]:{id:"",nome:""}}:{[e.nomeColuna]:""});e.push(t),et(e)},eO=[{id:1,name:"recebimentoMP",identification:"01",route:"relatorio/recebimentoMP",params:{recebimentompID:eb,unidadeID:u.unidadeID}},{id:2,name:"Recep\xe7\xe3o",identification:"02",route:"/relatorio/recepcao"}],eF=async()=>{try{await E.h.post("".concat(eh,"/verifyFormPending/").concat(eb),{parFormularioID:2}).then(e=>{B(e.data) //! true/false
})}catch(e){console.log(e)}},eR=()=>{try{N(!0),E.h.post("".concat(eh,"/getNewData"),{unidadeID:u.unidadeID}).then(e=>{G(e.data.fields),$(e.data.fieldsProducts),et(e.data.dataProducts),en(e.data.blocos),er(e.data.info),ep({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),N(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},ek=()=>{N(!0),E.h.post("".concat(eh,"/getData/").concat(eb),{type:ev,unidadeID:u.unidadeID}).then(e=>{G(e.data.fields),X(e.data.data),$(e.data.fieldsProducts),et(e.data.dataProducts),en(e.data.blocos),er(e.data.info),eT(e.data),H(y.WR[e.data.info.status]),ep({status:e.data.info.status<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eF(),N(!1)})},eM=(e,t)=>{if(1==ee.length){k.ZP.error("Voc\xea deve ter ao menos um produto!");return}let a=[...ee];if(a.splice(t,1),et(a),(null==e?void 0:e.recebimentompProdutoID)>0){let o=[...ea,{recebimentompProdutoID:e.recebimentompProdutoID}];eo(o)}eD({...ej(),produtos:a}),eg(),k.ZP.success("Produto pr\xe9-removido. Salve para concluir!")},eT=e=>{var t,a,o;null==e||null===(t=e.fields)||void 0===t||t.map(t=>{var a,o,s,n;"int"==t.tipo?eZ("header.".concat(t.tabela),(null===(a=e.data)||void 0===a?void 0:a[t.tabela])?null===(o=e.data)||void 0===o?void 0:o[t.tabela]:null):"date"==t.tipo?eZ("header.".concat(t.nomeColuna),new Date(null===(s=e.data)||void 0===s?void 0:s[t.nomeColuna]).toISOString().split("T")[0]):eZ("header.".concat(t.nomeColuna),null===(n=e.data)||void 0===n?void 0:n[t.nomeColuna])}),e.dataProducts.map((t,a)=>{e.fieldsProducts.map((e,o)=>{"int"==e.tipo?(console.log("\uD83D\uDE80 ~ data?.[field.tabela]:",null==t?void 0:t[e.tabela]),eZ("produtos[".concat(a,"].").concat(e.tabela),(null==t?void 0:t[e.tabela])?null==t?void 0:t[e.tabela]:null)):eZ("produtos[".concat(a,"].").concat(e.nomeColuna),null==t?void 0:t[e.nomeColuna])})}),e.blocos.map((e,t)=>{e.itens.map((e,a)=>{(null==e?void 0:e.resposta)&&eZ("blocos[".concat(t,"].itens[").concat(a,"].resposta"),null==e?void 0:e.resposta)})}),eZ("obs",null===(a=e.info)||void 0===a?void 0:a.obs),eZ("status",null===(o=e.info)||void 0===o?void 0:o.status)},eV=()=>{eI();let e=!1,t=[];null==A||A.forEach((a,o)=>{let s=a.tabela?"header.".concat(a.tabela):"header.".concat(a.nomeColuna),n=ej(s);1!==a.obrigatorio||n||(eP(s,{type:"manual",message:"Campo obrigat\xf3rio"}),t.push(null==a?void 0:a.nomeCampo),e=!0)}),ee.forEach((a,o)=>{Y.forEach((a,s)=>{let n=a.tabela?"produtos[".concat(o,"].").concat(a.tabela):"produtos[".concat(o,"].").concat(a.nomeColuna),l=ej(n);1!==a.obrigatorio||l||(eP(n,{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==a?void 0:a.nomeCampo),e=!0)})}),es.forEach((a,o)=>{a.itens.forEach((a,s)=>{let n=ej("blocos[".concat(o,"].itens[").concat(s,"].resposta"));(null==a?void 0:a.obrigatorio)!==1||n||(eP("blocos[".concat(o,"].itens[").concat(s,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==a?void 0:a.nome),e=!0)})}),ed({status:e,errors:t})},eN=()=>{eV(),ec(!0),L(!0)},e_=async e=>{e.conclusion=!0,await eS(ez)(e)},ez=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t.conclusion&&t.status>10&&(e.status=t.status,e.obsConclusao=t.obsConclusao);let a={forms:{...e,header:{...e.header},produtos:[...e.produtos],removedProducts:ea},auth:{usuarioID:i.usuarioID,papelID:i.papelID,unidadeID:u.unidadeID}};try{"edit"==ev?(z(!0),await E.h.put("".concat(eh,"/").concat(eb),a).then(e=>{k.ZP.success(y.OD.successUpdate),z(!1)})):"new"==ev?await E.h.post("".concat(eh,"/insertData"),a).then(e=>{let t=e.data;ex.push("".concat(eh,"/").concat(t)),k.ZP.success(y.OD.successNew)}):k.ZP.error(y.OD.error)}catch(o){console.log(o)}};return(0,s.useEffect)(()=>{I("Recebimento de MP"),"new"==ev?eR():ek()},[_]),(0,s.useEffect)(()=>{eV()},[]),(0,o.jsx)(o.Fragment,{children:V?(0,o.jsx)(R.Z,{}):(0,o.jsxs)("form",{onSubmit:eS(ez),children:[!em.status&&(0,o.jsx)(b.Z,{severity:em.messageType,sx:{mb:2},children:em.message}),(0,o.jsxs)(h.Z,{children:[(0,o.jsx)(w.Z,{btnCancel:!0,btnSave:el.status<40||"new"==ev,btnSend:"edit"==ev,btnPrint:!0,generateReport:y.OE,dataReports:eO,handleSubmit:()=>eS(ez),handleSend:eN,title:"Recebimento MP",btnStatus:"edit"==ev,handleBtnStatus:()=>K(!0)}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(f.Z,{sx:{mb:4},children:(0,o.jsx)(f.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,o.jsx)(x.Z,{size:"small",skin:"light",color:null!==(e=null==q?void 0:q.color)&&void 0!==e?e:"primary",label:null!==(t=null==q?void 0:q.title)&&void 0!==t?t:"Novo preenchimento",sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})}),(0,o.jsx)(r.Z,{register:eC,errors:ey,setValue:eZ,fields:A,values:Q,isDisabled:!em.status})]})]}),(0,o.jsx)(h.Z,{sx:{mt:4},children:(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(g.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700,mb:5},children:"PRODUTOS"}),Y&&ee&&ee.map((e,t)=>(0,o.jsxs)(f.Z,{display:"flex",justifyContent:"space-between",gap:4,sx:{mb:4},children:[Y.map((a,s)=>(0,o.jsx)(f.Z,{flex:1,children:(0,o.jsx)(d,{field:a,data:e,indexData:t,isDisabled:!em.status,register:eC,setValue:eZ,errors:ey})},s)),(0,o.jsx)(f.Z,{children:(0,o.jsx)(D.Z,{title:"Remover este item",children:(0,o.jsx)(C.Z,{color:"error",disabled:!em.status,onClick(){eM(e,t)},sx:{marginTop:2,opacity:1,cursor:"pointer"},children:(0,o.jsx)(l.Z,{icon:"tabler:trash-filled"})})})})]},t)),(0,o.jsx)(j.Z,{variant:"outlined",color:"primary",disabled:!em.status,sx:{mt:1},startIcon:(0,o.jsx)(l.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick(){ew()},children:"Inserir produto"})]})}),es&&es.map((e,t)=>(0,o.jsx)(m.Z,{index:t,blockKey:"parRecebimentompBlocoID",values:e,register:eC,setValue:eZ,errors:ey,isDisabled:!em.status},t)),el&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.Z,{sx:{mt:4},children:(0,o.jsx)(v.Z,{children:(0,o.jsx)(Z.ZP,{container:!0,spacing:4,children:(0,o.jsx)(Z.ZP,{item:!0,xs:12,md:12,children:(0,o.jsxs)(S.Z,{fullWidth:!0,children:[(0,o.jsx)(g.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,o.jsx)(c.Z,{multiline:!0,rows:4,label:"Observa\xe7\xe3o (opcional)",disabled:!em.status,placeholder:"Observa\xe7\xe3o (opcional)",defaultValue:null!==(a=el.obs)&&void 0!==a?a:"",name:"obs",...eC("obs")})]})})})})})}),J&&(0,o.jsx)(p.Z,{id:eb,parFormularioID:2,formStatus:el.status,hasFormPending:U,canChangeStatus:el.status>30&&!U,openModal:J,handleClose:()=>K(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(eb," de Recebimento de MP."),btnCancel:!0,btnConfirm:!0,handleSubmit:eE}),(0,o.jsx)(T.Z,{openModal:ei,handleClose(){ec(!1),L(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:el,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:e_,listErrors:eu})]})})};var N=V}}]);