(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,r,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return o(18442)}])},45061:function(e,r,o){"use strict";var n=o(85893),t=o(75084),a=o(29620),i=o(77745),s=o(95398),l=o(76779),c=o(44642);o(21609);var d=o(55343),u=o(67836),m=o(29630),p=o(19604),x=o(67294),f=o(82747);let h=e=>{let{title:r,text:o,handleClose:h,openModal:g,handleSubmit:j,cnpj:v,inputEmail:b,btnCancel:C,btnConfirm:Z,btnCancelColor:F,btnConfirmColor:D}=e,[y,w]=(0,x.useState)(null),[I,E]=(0,x.useState)(!1);return console.log("dialog email: ",y),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(a.Z,{open:g,onClose:h,"aria-labelledby":"form-dialog-title",children:[(0,n.jsx)(i.Z,{id:"form-dialog-title",children:r}),(0,n.jsxs)(s.Z,{children:[(0,n.jsx)(c.Z,{sx:{mb:3},children:o}),b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{sx:{mt:2},fullWidth:!0,children:[(0,n.jsx)(u.Z,{defaultValue:"",type:"email",label:"E-mail do Fornecedor (opcional)",placeholder:"E-mail do Fornecedor (opcional)","aria-describedby":"validation-schema-nome",name:"email",error:(null==y?void 0:y.length)>0&&I,inputProps:{onChange(e){w(e.target.value),E(!(0,f.dI)(e.target.value))}}}),(null==y?void 0:y.length)>0&&I&&(0,n.jsx)(m.Z,{variant:"body2",color:"error",children:"Por favor, insira um e-mail v\xe1lido!"})]}),(0,n.jsx)(p.Z,{severity:"info",sx:{mt:2},children:"Se o e-mail for preenchido, o mesmo receber\xe1 as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio no e-mail."})]})]}),(0,n.jsxs)(l.Z,{className:"dialog-actions-dense",children:[C&&(0,n.jsx)(t.Z,{variant:"outlined",color:"primary",onClick:h,children:"Cancelar"}),Z&&(0,n.jsx)(t.Z,{variant:"contained",disabled:b&&(null==y?void 0:y.length)>0&&I,color:D||"error",onClick:b&&v?()=>{j(v,y),w(null),h()}:b&&!v?()=>{j(y),w(null),h()}:()=>{j(),h()},children:"Confirmar"})]})]})})};r.Z=h},47842:function(e,r,o){"use strict";var n=o(85893),t=o(70754),a=o(61953);let i=()=>(0,n.jsx)(a.Z,{sx:{position:"absolute",top:"50%",left:"50%"},children:(0,n.jsx)(t.Z,{})});r.Z=i},49540:function(e,r,o){"use strict";o.d(r,{X1:function(){return c},p6:function(){return s},q:function(){return l}});var n=o(30381),t=o.n(n),a=o(68214),i=o.n(a);function s(e,r){let o=t()(e),n=o.format(r);return n}function l(e){let r=i()(e).toString();return r}function c(e){return e.replace(/[^0-9]/g,"")}},46749:function(e,r,o){"use strict";o.d(r,{Lo:function(){return m},OD:function(){return u},OE:function(){return x},OL:function(){return d},WR:function(){return c},g_:function(){return p}});var n=o(85893),t=o(29630),a=o(41664),i=o.n(a),s=o(7071);o(67294),o(40039);var l=o(60664);let c={1:{title:"Ativo",color:"success"},0:{title:"Inativo",color:"secondary"},10:{title:"Pendente",color:"warning"},20:{title:"Acessou link",color:"info"},30:{title:"Em preenchimento",color:"warning"},40:{title:"Conclu\xeddo",color:"primary"},50:{title:"Reprovado",color:"error"},60:{title:"Aprovado Parcial",color:"warning"},70:{title:"Aprovado",color:"success"}},d=(e,r)=>r.map((o,a)=>{let l=r[a].field;return{...o,flex:o.size,renderCell:o=>(0,n.jsx)(i(),{href:"".concat(e,"/").concat(o.row.id),children:(0,n.jsx)(t.Z,{variant:"body2",sx:{color:"text.primary"},children:r&&r.map((e,r)=>{if(e.field===l){if("status"!=e.field)return o.row[e.field];{let t=c[o.row.status];return(0,n.jsx)(s.Z,{size:"small",skin:"light",color:t.color,label:t.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}},r)}}})})})}}),u={successNew:"Dados salvos com sucesso!",successUpdate:"Dados atualizados com sucesso!",errorNew:"Erro ao salvar os dados!",errorRepeated:"Dados j\xe1 existentes!",errorUpdate:"Erro ao atualizar os dados!",errorDelete:"Erro ao excluir os dados!",successDelete:"Dados exclu\xeddos com sucesso!",pendingDelete:"Dado n\xe3o pode ser excluido, pois j\xe1 est\xe1 sendo utilizado!",errorGet:"Erro ao obter os dados!",successGet:"Dados obtidos com sucesso!"},m=e=>{let r=e.split("/"),o=r[r.length-1];return"novo"==o?"new":"edit"},p=e=>{let r=e.split("/");return r.pop(),r.join("/")},x=e=>{let r=e.route;console.log("fun\xe7\xe3o report"),l.h.post(r,null,{responseType:"arraybuffer"}).then(e=>{let r=new Blob([e.data],{type:"application/pdf"}),o=URL.createObjectURL(r),n=window.open(o,"_blank");n||(window.location.href=o)}).catch(e=>{console.error("Erro ao gerar relat\xf3rio",e)})}},34175:function(e,r,o){"use strict";function n(e){return e&&(e=(e=(e=(e=(e=e.replace(/\D/g,"")).replace(/^(\d{2})(\d)/,"$1.$2")).replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3")).replace(/\.(\d{3})(\d)/,".$1/$2")).replace(/(\d{4})(\d)/,"$1-$2")),e}function t(e){return e&&(e=(e=(e=(e=e.replace(/\D/g,"")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2")),e}function a(e){return e=(e=(e=(e=e.replace(/\D/g,"")).replace(/^(\d{2})(\d)/g,"($1) $2")).replace(/(\d)(\d{4})$/,"$1-$2")).replace(/\)-/,")")}function i(e){return e=(e=e.replace(/\D/g,"")).replace(/^(\d{5})(\d)/,"$1-$2")}function s(e){return e=(e=e.toUpperCase()).replace(/[^A-Z]/g,"")}o.d(r,{Bk:function(){return a},CL:function(){return s},PK:function(){return n},Tc:function(){return i},VL:function(){return t}})},82747:function(e,r,o){"use strict";function n(e){if(14!==(e=e.replace(/[^\d]+/g,"")).length||/^(\d)\1+$/.test(e))return!1;let r=e.length-2,o=e.substring(0,r),n=e.substring(r),t=0,a=r-7;for(let i=r;i>=1;i--)t+=o.charAt(r-i)*a--,a<2&&(a=9);let s=t%11<2?0:11-t%11;if(s!=n.charAt(0))return!1;r+=1,o=e.substring(0,r),t=0,a=r-7;for(let l=r;l>=1;l--)t+=o.charAt(r-l)*a--,a<2&&(a=9);return(s=t%11<2?0:11-t%11)==n.charAt(1)}function t(e){let r;if(11!==(e=e.replace(/[^\d]+/g,"")).length||/^(\d)\1+$/.test(e))return!1;let o=0;for(let n=1;n<=9;n++)o+=parseInt(e.substring(n-1,n))*(11-n);if((10==(r=10*o%11)||11===r)&&(r=0),r!==parseInt(e.substring(9,10)))return!1;o=0;for(let t=1;t<=10;t++)o+=parseInt(e.substring(t-1,t))*(12-t);return(10==(r=10*o%11)||11===r)&&(r=0),r===parseInt(e.substring(10,11))}function a(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}o.d(r,{dI:function(){return a},sw:function(){return t},zk:function(){return n}})},18442:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return N}});var n=o(85893),t=o(67294),a=o(60664),i=o(40372),s=o(91359),l=o(60565),c=o(40039),d=o(29620),u=o(77745),m=o(95398),p=o(44642),x=o(79072),f=o(55343),h=o(67836),g=o(29630),j=o(19604),v=o(75084),b=o(76779),C=o(11163),Z=o(21609),F=o(49540),D=o(34175),y=o(82747),w=o(87536),I=o(86501),E=o(45061);let P=e=>{var r;let{handleClose:o,openModal:i,unidades:s,setSelectedUnit:P,makeFornecedor:S,loadingSave:k}=e;(0,C.useRouter)();let[$,z]=(0,t.useState)(!1),{user:N,loggedUnity:A}=(0,t.useContext)(c.V),{handleSearch:T}=(0,t.useContext)(l.f),[_,J]=(0,t.useState)(null),[L,M]=(0,t.useState)(null),[R,O]=(0,t.useState)(!1),[q,U]=(0,t.useState)(null),[H,V]=(0,t.useState)(!1),[B,W]=(0,t.useState)(!1),[G,X]=(0,t.useState)(!1),[K,Q]=(0,t.useState)(!1);console.log("unidade logada: "+A.nomeFantasia);let{handleSubmit:Y,formState:{errors:ee},setValue:er,register:eo}=(0,w.cI)({});console.log("\uD83D\uDE80 ~ errors:",ee),console.log("\uD83D\uDE80 ~ email:",q);let en=()=>{Q(!0),setTimeout(()=>{Q(!1)},5e3);let e=(0,F.q)((0,F.X1)(L)),r=(0,F.q)(A.unidadeID),o=window.location.origin,n="".concat(o,"/fornecedor?c=").concat(e,"&u=").concat(r);navigator.clipboard.writeText(n)},et=async e=>{console.log("getFornecedorByCnpj: ",e),e&&18===e.length&&((0,y.zk)(e)?(z(!0),V(!1),await a.h.post("/formularios/fornecedor/cnpj",{unidadeID:A.unidadeID,cnpj:e}).then(r=>{console.log("\uD83D\uDE80 ~ getFornecedorByCnpj response:",r.data),J(r.data),M(e),z(!1)})):(M(null),V(!0)))},ea=async()=>{console.log("filtra no contexto..."),T(L),o()},ei=async()=>{z(!0),await a.h.post("/formularios/fornecedor/fornecedorStatus",{unidadeID:A.unidadeID,cnpj:L,status:1}).then(e=>{200===e.status?(J(e.data),I.Am.success("Fornecedor reativado com sucesso")):I.Am.error("Erro ao reativar fornecedor"),z(!1)})},es=()=>{X(!0)},el=e=>{console.log("\uD83D\uDE80 ~ onSubmit ~ values:",e)};return(0,t.useEffect)(()=>{console.log("ON USEeFFECT: ",k),et(L),J(null),Y(el),M(null),U(null)},[i,k]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{open:i,onClose:o,"aria-labelledby":"form-dialog-title",children:[(0,n.jsx)(u.Z,{id:"form-dialog-title",children:"Habilitar novo fornecedor"}),(0,n.jsxs)(m.Z,{children:[(0,n.jsxs)(p.Z,{sx:{mb:3},children:["Insira o CNPJ da empresa que deseja habilitar como um novo fornecedor. Com isso, a empresa ficar\xe1 apta a preencher formul\xe1rios para a ",A.nomeFantasia,"."]}),(0,n.jsx)("form",{onSubmit:Y(el),children:(0,n.jsxs)(x.ZP,{container:!0,children:[(0,n.jsx)(x.ZP,{item:!0,xs:12,md:12,children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(h.Z,{defaultValue:(null==_?void 0:_.cnpj)?_.cnpj:"",label:"CNPJ",placeholder:"CNPJ","aria-describedby":"validation-schema-nome",name:"cnpj",error:H,...eo("cnpj",{required:!0,validate:e=>(0,y.zk)(e)||"CNPJ inv\xe1lido"}),helperText:null===(r=ee.cnpj)||void 0===r?void 0:r.message,inputProps:{maxLength:18,onChange(e){J(null),er("cnpj",(0,D.PK)(e.target.value)),M((0,D.PK)(e.target.value)),et(e.target.value),O(!1)}}}),H&&(0,n.jsx)(g.Z,{variant:"body2",color:"error",children:"Por favor, insira um CNPJ v\xe1lido!"})]})}),_&&_.isFornecedor&&!_.hasFormulario&&R&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,n.jsx)(f.Z,{fullWidth:!0,children:(0,n.jsx)(h.Z,{defaultValue:"",type:"email",label:"E-mail",placeholder:"E-mail","aria-describedby":"validation-schema-nome",name:"email",...eo("email",{required:!0,validate:e=>e.includes("@")||"E-mail inv\xe1lido"}),error:B,helperText:B?"Insira um e-mail v\xe1lido":null,inputProps:{onChange(e){er("email",e.target.value),U(e.target.value),W(!(0,y.dI)(e.target.value))}}})})}),(0,n.jsx)(x.ZP,{item:!0,xs:12,md:12,sx:{mt:2},children:(0,n.jsx)(j.Z,{severity:"info",children:"Um e-mail ser\xe1 enviado para o fornecedor com as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio"})})]})]})}),_&&(0,n.jsx)(x.ZP,{container:!0,sx:{mt:2},children:(0,n.jsx)(x.ZP,{item:!0,xs:12,md:12,children:_.isFornecedor&&_.hasFormulario?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(j.Z,{severity:"success",children:["Esse CNPJ est\xe1 habilitado como um Fornecedor da ",A.nomeFantasia]}),(0,n.jsx)(v.Z,{startIcon:(0,n.jsx)(Z.Z,{icon:K?"mdi:check-bold":"iconamoon:copy-bold"}),sx:{mt:2},onClick:K?null:en,style:{cursor:K?"default":"pointer"},children:K?"Copiado!":"Copiar Link do Formul\xe1rio"})]}):_.isFornecedor&&!_.hasFormulario?(0,n.jsx)(j.Z,{severity:"warning",children:"Esse CNPJ j\xe1 \xe9 seu fornecedor, mas n\xe3o h\xe1 nenhum formul\xe1rio criado"}):!_.isFornecedor&&_.hasFormulario?(0,n.jsx)(j.Z,{severity:"warning",children:"Esse CNPJ n\xe3o est\xe1 mais ativo como um fornecedor mas possui formul\xe1rios preenchidos"}):_.isFornecedor||_.hasFormulario?null:(0,n.jsx)(j.Z,{severity:"info",children:"Esse CNPJ ainda n\xe3o \xe9 seu fornecedor"})})})]}),(0,n.jsxs)(b.Z,{className:"dialog-actions-dense",sx:{mx:2,mb:2},children:[(0,n.jsx)(v.Z,{variant:"outlined",onClick:o,children:"Fechar"}),_&&(_.isFornecedor&&_.hasFormulario||!_.isFornecedor&&_.hasFormulario||!_.isFornecedor&&!_.hasFormulario)&&(0,n.jsx)(v.Z,{variant:"contained",onClick:_.isFornecedor&&_.hasFormulario?ea:!_.isFornecedor&&_.hasFormulario?ei:_.isFornecedor||_.hasFormulario?null:es,children:_.isFornecedor&&_.hasFormulario?"Filtrar formul\xe1rios":!_.isFornecedor&&_.hasFormulario?"Reativar fornecedor":_.isFornecedor||_.hasFormulario?null:"Tornar meu fornecedor"})]})]}),(0,n.jsx)(E.Z,{title:"Confirmar novo fornecedor",text:"Tem certeza que deseja tornar o CNPJ ".concat(L," um fornecedor ativo na ").concat(A.nomeFantasia," ? Se sim, o mesmo poder\xe1 preencher formul\xe1rios de Fornecedor para a sua empresa."),handleClose:()=>X(!1),openModal:G,handleSubmit:S,inputEmail:!0,cnpj:L,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary"})]})};var S=o(47842),k=o(46749),$=o(49837);let z=()=>{let{user:e,loggedUnity:r}=(0,t.useContext)(c.V),[o,d]=(0,t.useState)(null),u=(0,C.useRouter)(),m=u.pathname,{setTitle:p}=(0,t.useContext)(l.f),[x,f]=(0,t.useState)(!1),[h,g]=(0,t.useState)(!1);console.log("result: ",o);let j=()=>{f(!0)};(0,t.useEffect)(()=>{let o=async()=>{await a.h.post("".concat(m,"/getList"),{unidadeID:r.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{d(e.data),p("Fornecedor")})};o()},[h]);let v=async(o,n)=>{console.log("\uD83D\uDE80 ~ makeFornecedor ~ cnpj, email:",o,n);try{g(!0),await a.h.post("/formularios/fornecedor/makeFornecedor",{usuarioID:e.usuarioID,unidadeID:r.unidadeID,papelID:e.papelID,cnpj:o}).then(e=>{200===e.status?(I.Am.success("Fornecedor habilitado com sucesso"),console.log("tornou um fornecedor....."),n&&(console.log("\uD83D\uDE80 enviando email para ",n),b(n,o))):I.Am.error("Erro ao tornar fornecedor"),g(!1)})}catch(t){console.log(t)}},b=(e,o)=>{if(e&&(0,y.dI)(e)){let n={unidadeID:r.unidadeID,cnpj:o,destinatario:e};console.log("send email data: ",n),a.h.post("/formularios/fornecedor/sendMail",{data:n}).then(e=>{I.Am.success("E-mail enviado com sucesso")}).catch(e=>{console.error("Erro ao enviar email",e)})}},Z=async()=>{await a.h.post("".concat(m,"/getList"),{unidadeID:r.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{d(e.data),p("Fornecedor")})};(0,t.useEffect)(()=>{Z(),console.log("useEffect da listagem...")},[h]),console.log("dados do bakc",o);let F=(0,k.OL)(m,[{title:"ID",field:"id",size:.1},{title:"Fantasia",field:"fantasia",size:.4},{title:"CNPJ",field:"cnpj",size:.2},{title:"Cidade",field:"cidade",size:.2},{title:"UF",field:"estado",size:.1},{title:"Status",field:"status",size:.2}]);return(0,n.jsxs)(n.Fragment,{children:[!o&&(0,n.jsx)(S.Z,{}),o&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)($.Z,{children:(0,n.jsx)(s.Z,{sx:{pt:"0"},children:(0,n.jsx)(i.Z,{rows:o,columns:F,buttonsHeader:{btnNew:1==e.papelID,btnPrint:!0,openModal:1==e.papelID?j:null}})})})}),(0,n.jsx)(P,{title:"Excluir dado",text:"Tem certeza que deseja excluir?",openModal:x,handleClose:()=>f(!1),makeFornecedor:v,btnCancel:!0,btnConfirm:!0,loadingSave:h})]})};var N=z},40372:function(e,r,o){"use strict";o.d(r,{Z:function(){return F}});var n=o(85893),t=o(67294),a=o(11163),i=o.n(a),s=o(46852),l=o(75680),c=o(61953),d=o(67836),u=o(80562),m=o(50853),p=o(91359),x=o(75084),f=o(41664),h=o.n(f),g=o(40039),j=o(21609);let v=e=>{let{btnNew:r,btnPrint:o,openModal:a}=e,s=i(),{routes:l}=(0,t.useContext)(g.V);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(p.Z,{sx:{display:"flex",justifyContent:"end",alignItems:"center",p:"0",m:"0"},children:(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:"8px"},children:[o&&(0,n.jsx)(x.Z,{onClick:()=>window.print(),type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,n.jsx)(j.Z,{icon:"mdi:printer"}),children:"Imprimir"}),r&&l.find(e=>e.rota===s.pathname&&e.inserir)&&(0,n.jsx)(h(),{href:a?"":"".concat(s.pathname,"/novo"),children:(0,n.jsx)(x.Z,{type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,n.jsx)(j.Z,{icon:"ic:outline-plus"}),onClick:a||null,children:"Novo"})})]})})})},b=e=>(0,n.jsxs)(c.Z,{sx:{display:"flex",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",p:e=>e.spacing(8,0,0,0)},children:[(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:"8px",textAlig:"end"},children:[(0,n.jsx)(d.Z,{size:"medium",value:e.value,onChange:e.onChange,placeholder:"Buscar…",variant:"standard",InputProps:{startAdornment:(0,n.jsx)(c.Z,{sx:{mr:2,display:"flex"},children:(0,n.jsx)(j.Z,{icon:"mdi:magnify",fontSize:20})}),endAdornment:(0,n.jsx)(u.Z,{size:"medium",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,n.jsx)(j.Z,{icon:"mdi:close",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}}),(0,n.jsx)(m.M,{})]}),(0,n.jsx)(c.Z,{children:(0,n.jsx)(v,{btnNew:e.buttonsHeader.btnNew,btnPrint:e.buttonsHeader.btnPrint,openModal:e.buttonsHeader.openModal})})]});var C=o(60565);let Z=e=>{let{rows:r,columns:o,buttonsHeader:i}=e,{handleSearch:c,pageSize:d,setPageSize:u,searchText:m,filteredData:p,setData:x,data:f}=(0,t.useContext)(C.f);x(r);let h=(0,a.useRouter)(),g=h.pathname;return(0,n.jsx)(s._,{localeText:l.F.components.MuiDataGrid.defaultProps.localeText,autoHeight:!0,columns:o,pageSize:d,rowsPerPageOptions:[10,20,30,40,50,100],components:{Toolbar:b},rows:m?p:f,onRowClick:e=>h.push("".concat(g,"/").concat(e.row.id)),onPageSizeChange:e=>u(e),sx:{"& .MuiDataGrid-cell":{cursor:"pointer"}},componentsProps:{toolbar:{value:m,clearSearch:()=>c(""),onChange:e=>c(e.target.value),buttonsHeader:i}}})};var F=Z},42480:function(){}},function(e){e.O(0,[4885,7536,315,9516,4726,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);