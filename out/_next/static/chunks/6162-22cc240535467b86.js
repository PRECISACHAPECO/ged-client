"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6162],{86162:function(e,a,t){t.d(a,{Z:function(){return T}});var s=t(85893),o=t(67294),n=t(87536);t(21609),t(50196);var i=t(56531),r=t(81284),l=t(95309),d=t(29630),c=t(22841),u=t(75158);let p=e=>{let{title:a,values:t,name:o,changeCategory:n,register:i,isDisabled:p}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsx)(l.Z,{children:(0,s.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600},children:a})})}),t&&t.map((e,a)=>(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("input",{type:"hidden",name:"".concat(o,".[").concat(a,"].id"),defaultValue:e.id,...i("".concat(o,".[").concat(a,"].id"))}),(0,s.jsx)(c.Z,{control:(0,s.jsx)(u.Z,{name:"".concat(o,"[").concat(a,"].checked"),disabled:!!p,...i("".concat(o,"[").concat(a,"].checked")),defaultChecked:1==e.checked,onClick:a=>n?n(e.id,!!a.target.checked):null}),label:e.nome})]})},a))]})};var m=t(79139),x=t(19604),h=t(49837),f=t(91359),g=t(61953),I=t(79072),b=t(75084),D=t(55343),v=t(67836),j=t(11163),Z=t.n(j),y=t(46749),S=t(60664),C=t(89191),F=t(60565),P=t(40039),k=t(47842);t(49540);var w=t(86501),A=t(66136),E=t(11935),z=t(7071);t(13860),t(57548),t(45061);var q=t(34282);let O=()=>{var e;let{user:a,loggedUnity:t}=(0,o.useContext)(P.V),{setTitle:r}=(0,o.useContext)(F.f),[l,c]=(0,o.useState)(!1),[u,j]=(0,o.useState)(!1),[O,T]=(0,o.useState)(!1),[N,M]=(0,o.useState)([]),[R,V]=(0,o.useState)(null),[W,_]=(0,o.useState)([]),[Q,U]=(0,o.useState)([]),[B,L]=(0,o.useState)([]),[H,J]=(0,o.useState)([]),[K,G]=(0,o.useState)([]),[X,Y]=(0,o.useState)([]),[$,ee]=(0,o.useState)(""),[ea,et]=(0,o.useState)(!1),[es,eo]=(0,o.useState)(null),[en,ei]=(0,o.useState)(null),[er,el]=(0,o.useState)(!1),[ed,ec]=(0,o.useState)(!1),[eu,ep]=(0,o.useState)(!0),[em,ex]=(0,o.useState)(0),[eh,ef]=(0,o.useState)([]),[eg,eI]=(0,o.useState)({}),[eb,eD]=(0,o.useState)({status:!1,errors:[]}),[ev,ej]=(0,o.useState)(!1),[eZ,ey]=(0,o.useState)(null),[eS,eC]=(0,o.useState)([]),[eF,eP]=(0,o.useState)([]),[ek,ew]=(0,o.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eA=Z(),{id:eE}=eA.query,ez=(0,y.g_)(eA.pathname),eq=(0,y.Lo)(eA.pathname),{settings:eO}=(0,o.useContext)(A.J6),eT=eO.mode,{watch:eN,register:eM,control:eR,getValues:eV,clearErrors:eW,setValue:e_,setError:eQ,handleSubmit:eU,formState:{errors:eB}}=(0,n.cI)(),eL=localStorage.getItem("dynamicId"),eH=()=>{let{id:e}=eA.query;e&&localStorage.setItem("dynamicId",e)},eJ=()=>(eE||(eE=eL),eE);(0,o.useEffect)(()=>{let{id:e}=eA.query;eJ(e)},[]),(0,o.useEffect)(()=>{eH()},[]);let eK=e=>{var a;null==e||null===(a=e.blocos)||void 0===a||a.map((e,a)=>{var t;null==e||null===(t=e.itens)||void 0===t||t.map((e,t)=>{(null==e?void 0:e.resposta)&&e_("blocos[".concat(a,"].itens[").concat(t,"].resposta"),null==e?void 0:e.resposta)})}),e_()},eG=async()=>{try{await S.h.post("/formularios/fornecedor/verifyFormPending/".concat(eE),{parFormularioID:1}).then(e=>{ep(e.data) //! true/false
})}catch(e){console.log(e)}},eX=async e=>{let s={status:e,auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{j(!0),await S.h.post("".concat(ez,"/changeFormStatus/").concat(eE),s).then(e=>{w.ZP.success(y.OD.successUpdate),j(!1)})}catch(o){console.log(o)}},eY=async()=>{let e={status:{edit:er,status:$.status},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};if(er)try{j(!0),await S.h.post("".concat(ez,"/updateFormStatus/").concat(eE),e).then(e=>{w.ZP.success(y.OD.successUpdate),j(!1)})}catch(s){console.log(s)}else w.ZP.error("N\xe3o h\xe1 dados a serem atualizados!")},e$=[{id:1,name:"Formul\xe1rio do fornecedor",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor",papelID:a.papelID,identification:"01",params:{fornecedorID:eE}},{id:2,name:"Teste relat\xf3rio1",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor/teste",papelID:a.papelID,identification:"02"},{id:3,name:"Teste relat\xf3rio2",component:"Fornecedor",route:"/relatorio/fornecedor/dadosFornecedor/teste2",papelID:a.papelID,identification:"03"}],e0=(e,a)=>{let t=[];null==e||e.map((e,s)=>{e2(e.categorias,a)&&t.push(e)}),Y(t)},e1=(e,a)=>{let t=W.map(t=>t.id===e?{...t,checked:a}:t);_(t),e0(K,t)},e2=(e,a)=>{let t=e.map(e=>e.categoriaID),s=a.filter(e=>e.checked).map(e=>e.id);if(t.length!==s.length)return!1;let o=[...t].sort(),n=[...s].sort();for(let i=0;i<o.length;i++)if(o[i]!==n[i])return!1;return!0},e4=()=>{try{c(!0),eE&&S.h.get("".concat(ez,"/").concat(eE)).then(e=>{console.log("getData: ",e.data.grupoAnexo),M(e.data.fields),_(e.data.categorias),U(e.data.atividades),L(e.data.sistemasQualidade),G(e.data.blocos),e0(e.data.blocos,e.data.categorias),V(e.data.data),J(e.data.grupoAnexo),e.data.grupoAnexo.map((e,t)=>{e.itens.map((e,t)=>{e.anexo&&eS.push({titulo:e.nome,grupoAnexoItemID:e.grupoanexoitemID,arquivo:e.anexo,usuarioID:a.usuarioID,recebimentoMpID:"",naoConformidadeID:"",file:{status:!0,name:e.anexo.path,size:e.anexo.size,type:e.anexo.type,path:e.anexo.time}})})}),ee(e.data.info),eo(e.data.unidade),eK(e.data);let t=y.WR[e.data.info.status];ei(t),ew({status:2==a.papelID&&e.data.info.status<40,message:2==a.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==a.papelID?"warning":"info"}),c(!1)})}catch(e){console.log(e)}},e6=()=>{eA.push("/formularios/fornecedor/"),w.ZP.error("Voc\xea n\xe3o tem permiss\xf5es para acessar esta p\xe1gina!")},e3=()=>{e7(),et(!0),T(!0)},e5=async e=>{e.conclusion=!0,await eU(e9)(e)},e9=async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===s.conclusion&&(e.status=a&&1==a.papelID?s.status:40,e.obsConclusao=s.obsConclusao);let o={forms:{...e,header:{...e.header}},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:t.unidadeID}};try{j(!0),await S.h.put("".concat(ez,"/").concat(eE),o).then(e=>{w.ZP.success(y.OD.successUpdate),j(!1)})}catch(n){console.log(n)}},e7=()=>{eW();let e=!1,a=[];N.forEach((t,s)=>{let o=t.tabela?"header.".concat(t.tabela):"header.".concat(t.nomeColuna),n=eV(o);1!==t.obrigatorio||n||(eQ(o,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==t?void 0:t.nomeCampo),e=!0)}),X.forEach((t,s)=>{t.itens.forEach((t,o)=>{let n=eV("blocos[".concat(s,"].itens[").concat(o,"].resposta"));(null==t?void 0:t.obrigatorio)!==1||n||(eQ("blocos[".concat(s,"].itens[").concat(o,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==t?void 0:t.nome),e=!0)})}),eD({status:e,errors:a})};(0,o.useEffect)(()=>{r("Formul\xe1rio do Fornecedor"),"edit"==eq?e4():e6(),eG()},[u]),(0,o.useEffect)(()=>{e7()},[]),(0,o.useEffect)(()=>{ev&&w.ZP.success("Dados copiados com sucesso!")},[ev]);let e8=(0,o.useRef)(null),ae=e=>{e8.current.click(),ey(e)},aa=e=>{let t=e.target.files[0];if((null==t?void 0:t.type)!=="application/pdf"){w.ZP.error("Formato de arquivo inv\xe1lido, selecione um arquivo PDF!");return}let s=eS.find(e=>e.grupoAnexoItemID===eZ.grupoanexoitemID);if(s){let o={...s,titulo:eZ.nome,arquivo:t,file:{status:!0,name:t.name,size:t.size,type:t.type,time:new Date().getTime()}},n=eS.map(e=>e.grupoAnexoItemID===eZ.grupoanexoitemID?o:e);eF.splice(eF.indexOf(s),1),eC(n)}else{let i={titulo:eZ.nome,grupoAnexoItemID:eZ.grupoanexoitemID,arquivo:t,usuarioID:a.usuarioID,recebimentoMpID:"",naoConformidadeID:"",file:{status:!0,name:null==t?void 0:t.name,size:null==t?void 0:t.size,type:null==t?void 0:t.type}};eC([...eS,i]),eF.splice(eF.indexOf(s),1)}},at=async()=>{let e=new FormData;if(0===eS.length){w.ZP.error("Selecione ao menos um arquivo para enviar!");return}eS.forEach((a,s)=>{e.append("pdfFiles",a.arquivo),e.append("titulo",a.titulo),e.append("tamanho",a.file.size),e.append("grupoAnexoItemID",a.grupoAnexoItemID),e.append("usuarioID",a.usuarioID),e.append("recebimentoMpID",a.recebimentoMpID),e.append("naoConformidadeID",a.naoConformidadeID),e.append("unidadeID",t.unidadeID),e.append("arrAnexoRemoved",eF)}),await S.h.post("/formularios/fornecedor/saveAnexo/".concat(eE),e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{200===e.status&&(w.ZP.success("Anexos enviados com sucesso!"),eC([]),ey({}),j(!u))})},as=e=>{let a=eS.filter(a=>a.grupoAnexoItemID!==e);eC(a),eP([...eF,e])};return(0,s.jsxs)(s.Fragment,{children:[l?(0,s.jsx)(k.Z,{}):N?(0,s.jsxs)("form",{onSubmit:eU(e=>{ek.status?e9(e,!1):eY()}),children:[X&&0===X.length&&(0,s.jsx)(x.Z,{severity:"warning",sx:{mb:2},children:"N\xe3o h\xe1 nenhum bloco dispon\xedvel para as categorias selecionadas!"}),!ek.status&&(0,s.jsx)(x.Z,{severity:ek.messageType,sx:{mb:2},children:ek.message}),(0,s.jsxs)(h.Z,{children:[(0,s.jsx)(C.Z,{btnCancel:!0,btnSave:2==a.papelID&&$.status<40,btnSend:1==a.papelID&&$.status>=40||2==a.papelID&&$.status<40,disabledSend:0===X.length,disabledSubmit:0===X.length,disabledPrint:0===X.length,btnPrint:!0,generateReport:y.OE,dataReports:e$,handleSubmit:()=>eU(e9),handleSend:e3,title:"Fornecedor",btnStatus:!0,handleBtnStatus:()=>ec(!0)}),(0,s.jsxs)(f.Z,{children:[es&&(0,s.jsxs)(g.Z,{sx:{mb:4},children:[(0,s.jsx)("input",{type:"hidden",value:es.unidadeID,name:"unidadeID",...eM("unidadeID")}),(0,s.jsxs)(I.ZP,{container:!0,spacing:4,children:[(0,s.jsxs)(I.ZP,{item:!0,xs:12,md:6,children:[(0,s.jsx)(d.Z,{variant:"caption",children:"F\xe1brica:"}),(0,s.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600},children:es.nomeFantasia})]}),(0,s.jsx)(I.ZP,{item:!0,xs:12,md:6,children:en&&(0,s.jsx)(g.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,s.jsx)(z.Z,{size:"small",skin:"light",color:en.color,label:en.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})})]})]}),(0,s.jsx)(i.Z,{register:eM,errors:eB,setValue:e_,watch:eN,fields:N,values:R,isDisabled:!ek.status,setCopiedDataContext:ej}),(0,s.jsxs)(I.ZP,{container:!0,spacing:4,children:[(0,s.jsx)(I.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(p,{title:"Categorias",values:W,name:"categorias",changeCategory:e1,register:eM,isDisabled:!ek.status})}),(0,s.jsx)(I.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(p,{title:"Atividades",values:Q,name:"atividades",register:eM,isDisabled:!ek.status})}),(0,s.jsx)(I.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(p,{title:"Sistema de Qualidade",values:B,name:"sistemasQualidade",register:eM,isDisabled:!ek.status})})]})]})]}),X&&X.map((e,a)=>(0,s.jsx)(m.Z,{index:a,blockKey:"parFornecedorBlocoID",values:e,register:eM,setValue:e_,errors:eB,isDisabled:!ek.status},a)),H&&(0,s.jsxs)(s.Fragment,{children:[H.map((e,a)=>(0,s.jsx)(h.Z,{sx:{mt:4},children:(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:e.nome}),(0,s.jsx)(d.Z,{variant:"body2",sx:{mb:2},children:e.descricao}),(0,s.jsx)(I.ZP,{container:!0,spacing:4,children:e.itens.map((e,t)=>(0,s.jsx)(I.ZP,{item:!0,xs:12,md:4,children:(0,s.jsxs)(g.Z,{style:{border:"".concat("dark"==eT?"1px solid rgba(234, 234, 255, 0.10)":"1px solid rgba(76, 78, 100, 0.12)"),borderRadius:"12px",padding:"25px",paddingTop:"120px",display:"flex",flexDirection:"column",gap:"6px",position:"relative",zIndex:10},children:[(0,s.jsxs)("div",{onClick:()=>ae(e),className:"cursor-pointer ",children:[(0,s.jsx)("img",{src:"/images/storyset/a.svg",alt:"",className:"w-[20%] top-8 left-0 absolute"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:e.nome}),(0,s.jsx)(d.Z,{variant:"body2",sx:{mb:2},children:e.descricao})]})]}),(()=>{let a=eS.find(a=>e.grupoanexoitemID==a.grupoAnexoItemID);if(a){var t,o;return(0,s.jsxs)("div",{className:"flex p-2 items-center justify-between gap-2 rounded-lg ",style:{border:"".concat("dark"==eT?"1px dashed rgba(234, 234, 255, 0.10)":"1px dashed rgba(76, 78, 100, 0.12)")},children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("img",{width:28,height:28,alt:"invoice.pdf",src:"/images/icons/file-icons/pdf.png"}),(0,s.jsx)(d.Z,{variant:"body2",children:"".concat(null==a?void 0:null===(t=a.file)||void 0===t?void 0:t.name," (").concat(((null==a?void 0:null===(o=a.file)||void 0===o?void 0:o.size)/1024/1024).toFixed(2),"mb)")})]}),(0,s.jsx)("div",{style:{zIndex:9999},children:(0,s.jsx)(b.Z,{variant:"outlined",size:"small",onClick:()=>as(a.grupoAnexoItemID),children:"Remover"})})]})}return null})(),(0,s.jsx)("input",{type:"file",ref:e8,style:{display:"none"},onChange:aa})]})},"".concat(a,"-").concat(t)))})]})},a)),(0,s.jsx)(b.Z,{variant:"contained",onClick:at,children:"Enviar Anexos"})]}),(0,s.jsx)(h.Z,{sx:{mt:4},children:(0,s.jsx)(f.Z,{children:(0,s.jsx)(I.ZP,{container:!0,spacing:4,children:(0,s.jsx)(I.ZP,{item:!0,xs:12,md:12,children:(0,s.jsxs)(D.Z,{fullWidth:!0,children:[(0,s.jsx)(d.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,s.jsx)(v.Z,{multiline:!0,rows:4,label:"Observa\xe7\xe3o (opcional)",disabled:!ek.status,placeholder:"Observa\xe7\xe3o (opcional)",name:"obs",defaultValue:null!==(e=$.obs)&&void 0!==e?e:"",...eM("obs")})]})})})})})]}):null,(0,s.jsx)(E.Z,{openModal:ea,handleClose(){et(!1),T(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:$,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:e5,listErrors:eb}),ed&&(0,s.jsx)(q.Z,{id:eE,parFormularioID:1,formStatus:$.status,hasFormPending:eu,canChangeStatus:1==a.papelID&&!eu&&$.status>30,openModal:ed,handleClose:()=>ec(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(eE," do Fornecedor."),btnCancel:!0,btnConfirm:!0,handleSubmit:eX})]})};var T=O}}]);